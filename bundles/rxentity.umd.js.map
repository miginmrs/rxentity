{"version":3,"sources":["webpack://rxentity/webpack/universalModuleDefinition","webpack://rxentity/webpack/bootstrap","webpack://rxentity/./node_modules/altern-map/dist/esm/altern-map.js","webpack://rxentity/./node_modules/altern-map/dist/esm/index.js","webpack://rxentity/./node_modules/rxjs/internal/InnerSubscriber.js","webpack://rxentity/./node_modules/rxjs/internal/Observable.js","webpack://rxentity/./node_modules/rxjs/internal/Observer.js","webpack://rxentity/./node_modules/rxjs/internal/OuterSubscriber.js","webpack://rxentity/./node_modules/rxjs/internal/Subscriber.js","webpack://rxentity/./node_modules/rxjs/internal/Subscription.js","webpack://rxentity/./node_modules/rxjs/internal/config.js","webpack://rxentity/./node_modules/rxjs/internal/symbol/iterator.js","webpack://rxentity/./node_modules/rxjs/internal/symbol/observable.js","webpack://rxentity/./node_modules/rxjs/internal/symbol/rxSubscriber.js","webpack://rxentity/./node_modules/rxjs/internal/util/UnsubscriptionError.js","webpack://rxentity/./node_modules/rxjs/internal/util/canReportError.js","webpack://rxentity/./node_modules/rxjs/internal/util/hostReportError.js","webpack://rxentity/./node_modules/rxjs/internal/util/identity.js","webpack://rxentity/./node_modules/rxjs/internal/util/isArray.js","webpack://rxentity/./node_modules/rxjs/internal/util/isArrayLike.js","webpack://rxentity/./node_modules/rxjs/internal/util/isFunction.js","webpack://rxentity/./node_modules/rxjs/internal/util/isObject.js","webpack://rxentity/./node_modules/rxjs/internal/util/isPromise.js","webpack://rxentity/./node_modules/rxjs/internal/util/pipe.js","webpack://rxentity/./node_modules/rxjs/internal/util/subscribeTo.js","webpack://rxentity/./node_modules/rxjs/internal/util/subscribeToArray.js","webpack://rxentity/./node_modules/rxjs/internal/util/subscribeToIterable.js","webpack://rxentity/./node_modules/rxjs/internal/util/subscribeToObservable.js","webpack://rxentity/./node_modules/rxjs/internal/util/subscribeToPromise.js","webpack://rxentity/./node_modules/rxjs/internal/util/subscribeToResult.js","webpack://rxentity/./node_modules/rxjs/internal/util/toSubscriber.js","webpack://rxentity/./source/common.ts","webpack://rxentity/./source/entity/entity-abstract.ts","webpack://rxentity/./source/entity/entity-child-impl.ts","webpack://rxentity/./source/entity/entity-impl.ts","webpack://rxentity/./source/entity/entity-proxies.ts","webpack://rxentity/./source/entity/index.ts","webpack://rxentity/./source/index.ts","webpack://rxentity/./source/list/index.ts","webpack://rxentity/./source/list/stored-list.ts","webpack://rxentity/./source/store.ts","webpack://rxentity/./source/valued-observable.ts","webpack://rxentity/external {\"root\":[\"rxjs\"],\"commonjs\":\"rxjs\",\"commonjs2\":\"rxjs\",\"amd\":\"rxjs\"}","webpack://rxentity/external {\"root\":[\"rxjs\",\"operators\"],\"commonjs\":\"rxjs/operators\",\"commonjs2\":\"rxjs/operators\",\"amd\":\"rxjs/operators\"}"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4B;AACS;AAC2B;AACA;AACS;AAClE;AACP;AACA,2DAA2D,iDAAI,qBAAqB,0DAAG;AACvF;AACA,+EAA+E;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,6EAAe;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,6EAAe;AACnD;AACA;AACA,iCAAiC,8FAAiB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,oBAAoB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sC;;;;;;;;;;;;AC1EA;AAAA;AAAA;AAAA;AAA6B;AAC7B,iC;;;;;;;;;;;;ACDa;AACb;AACA;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D,mBAAmB,mBAAO,CAAC,gEAAc;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,2C;;;;;;;;;;;;ACxCa;AACb,8CAA8C,cAAc;AAC5D,uBAAuB,mBAAO,CAAC,kFAAuB;AACtD,qBAAqB,mBAAO,CAAC,8EAAqB;AAClD,mBAAmB,mBAAO,CAAC,8EAAqB;AAChD,aAAa,mBAAO,CAAC,8DAAa;AAClC,eAAe,mBAAO,CAAC,wDAAU;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,uBAAuB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,kBAAkB,EAAE,kBAAkB,oBAAoB,EAAE,eAAe,uBAAuB,EAAE;AAC9I,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sC;;;;;;;;;;;;ACpHa;AACb,8CAA8C,cAAc;AAC5D,eAAe,mBAAO,CAAC,wDAAU;AACjC,wBAAwB,mBAAO,CAAC,oFAAwB;AACxD;AACA;AACA,4BAA4B,EAAE;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,2BAA2B;AAC3B;AACA,oC;;;;;;;;;;;;ACjBa;AACb;AACA;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D,mBAAmB,mBAAO,CAAC,gEAAc;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,2C;;;;;;;;;;;;ACjCa;AACb;AACA;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D,mBAAmB,mBAAO,CAAC,0EAAmB;AAC9C,iBAAiB,mBAAO,CAAC,4DAAY;AACrC,qBAAqB,mBAAO,CAAC,oEAAgB;AAC7C,qBAAqB,mBAAO,CAAC,4FAAiC;AAC9D,eAAe,mBAAO,CAAC,wDAAU;AACjC,wBAAwB,mBAAO,CAAC,oFAAwB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAAqE,aAAa;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,6CAA6C;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,sC;;;;;;;;;;;;ACrPa;AACb,8CAA8C,cAAc;AAC5D,gBAAgB,mBAAO,CAAC,oEAAgB;AACxC,iBAAiB,mBAAO,CAAC,sEAAiB;AAC1C,mBAAmB,mBAAO,CAAC,0EAAmB;AAC9C,4BAA4B,mBAAO,CAAC,4FAA4B;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,iCAAiC;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA,+CAA+C,mGAAmG,EAAE;AACpJ;AACA,wC;;;;;;;;;;;;AC5Ia;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA,kC;;;;;;;;;;;;ACnBa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oC;;;;;;;;;;;;ACXa;AACb,8CAA8C,cAAc;AAC5D,mCAAmC,4EAA4E,EAAE;AACjH,sC;;;;;;;;;;;;ACHa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,wC;;;;;;;;;;;;ACRa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA,wGAAwG,sCAAsC,EAAE;AAChJ;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,+C;;;;;;;;;;;;ACfa;AACb,8CAA8C,cAAc;AAC5D,mBAAmB,mBAAO,CAAC,iEAAe;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0C;;;;;;;;;;;;ACnBa;AACb,8CAA8C,cAAc;AAC5D;AACA,4BAA4B,WAAW,EAAE;AACzC;AACA;AACA,2C;;;;;;;;;;;;ACNa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA,oC;;;;;;;;;;;;ACNa;AACb,8CAA8C,cA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","file":"rxentity.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"rxjs\"), require(\"rxjs/operators\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"rxjs\", \"rxjs/operators\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rxentity\"] = factory(require(\"rxjs\"), require(\"rxjs/operators\"));\n\telse\n\t\troot[\"rxentity\"] = factory(root[\"rxjs\"], root[\"rxjs\"][\"operators\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE_rxjs__, __WEBPACK_EXTERNAL_MODULE_rxjs_operators__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./source/index.ts\");\n","import { from } from \"rxjs\";\nimport { map } from \"rxjs/operators\";\nimport { OuterSubscriber } from \"rxjs/internal/OuterSubscriber\";\nimport { InnerSubscriber } from \"rxjs/internal/InnerSubscriber\";\nimport { subscribeToResult } from \"rxjs/internal/util/subscribeToResult\";\nexport function alternMap(project, options, resultSelector) {\n    if (typeof resultSelector === 'function') {\n        return (source) => source.pipe(alternMap((a, i) => from(project(a, i)).pipe(map((b, ii) => resultSelector(a, b, i, ii))), options));\n    }\n    return (source) => source.lift(new AlternMapOperator(project, options || {}));\n}\nclass AlternMapOperator {\n    constructor(project, options) {\n        this.project = project;\n        this.options = options;\n    }\n    call(subscriber, source) {\n        return source.subscribe(new AlternMapSubscriber(subscriber, this.project, this.options));\n    }\n}\nclass AlternMapSubscriber extends OuterSubscriber {\n    constructor(destination, project, options) {\n        super(destination);\n        this.project = project;\n        this.options = options;\n        this.index = 0;\n    }\n    _next(value) {\n        let result;\n        const index = this.index++;\n        try {\n            result = this.project(value, index);\n        }\n        catch (error) {\n            this.destination.error(error);\n            return;\n        }\n        this._innerSub(result, value, index);\n    }\n    _innerSub(result, value, index) {\n        const innerSubscription = this.innerSubscription;\n        const innerSubscriber = new InnerSubscriber(this, value, index);\n        const destination = this.destination;\n        destination.add(innerSubscriber);\n        this.innerSubscription = subscribeToResult(this, result, undefined, undefined, innerSubscriber);\n        if (this.innerSubscription !== innerSubscriber) {\n            destination.add(this.innerSubscription);\n        }\n        if (innerSubscription) {\n            innerSubscription.unsubscribe();\n        }\n    }\n    _complete() {\n        const { innerSubscription } = this;\n        if (!innerSubscription || innerSubscription.closed || this.options.completeWithSource) {\n            super._complete();\n        }\n        this.unsubscribe();\n    }\n    _unsubscribe() {\n        this.innerSubscription = null;\n    }\n    notifyComplete(innerSub) {\n        const destination = this.destination;\n        destination.remove(innerSub);\n        this.innerSubscription = null;\n        if (this.isStopped || this.options.completeWithInner) {\n            super._complete();\n        }\n    }\n    notifyNext(outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n        this.destination.next(innerValue);\n    }\n}\n//# sourceMappingURL=altern-map.js.map","export * from './altern-map';\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Subscriber_1 = require(\"./Subscriber\");\nvar InnerSubscriber = (function (_super) {\n    __extends(InnerSubscriber, _super);\n    function InnerSubscriber(parent, outerValue, outerIndex) {\n        var _this = _super.call(this) || this;\n        _this.parent = parent;\n        _this.outerValue = outerValue;\n        _this.outerIndex = outerIndex;\n        _this.index = 0;\n        return _this;\n    }\n    InnerSubscriber.prototype._next = function (value) {\n        this.parent.notifyNext(this.outerValue, value, this.outerIndex, this.index++, this);\n    };\n    InnerSubscriber.prototype._error = function (error) {\n        this.parent.notifyError(error, this);\n        this.unsubscribe();\n    };\n    InnerSubscriber.prototype._complete = function () {\n        this.parent.notifyComplete(this);\n        this.unsubscribe();\n    };\n    return InnerSubscriber;\n}(Subscriber_1.Subscriber));\nexports.InnerSubscriber = InnerSubscriber;\n//# sourceMappingURL=InnerSubscriber.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar canReportError_1 = require(\"./util/canReportError\");\nvar toSubscriber_1 = require(\"./util/toSubscriber\");\nvar observable_1 = require(\"./symbol/observable\");\nvar pipe_1 = require(\"./util/pipe\");\nvar config_1 = require(\"./config\");\nvar Observable = (function () {\n    function Observable(subscribe) {\n        this._isScalar = false;\n        if (subscribe) {\n            this._subscribe = subscribe;\n        }\n    }\n    Observable.prototype.lift = function (operator) {\n        var observable = new Observable();\n        observable.source = this;\n        observable.operator = operator;\n        return observable;\n    };\n    Observable.prototype.subscribe = function (observerOrNext, error, complete) {\n        var operator = this.operator;\n        var sink = toSubscriber_1.toSubscriber(observerOrNext, error, complete);\n        if (operator) {\n            sink.add(operator.call(sink, this.source));\n        }\n        else {\n            sink.add(this.source || (config_1.config.useDeprecatedSynchronousErrorHandling && !sink.syncErrorThrowable) ?\n                this._subscribe(sink) :\n                this._trySubscribe(sink));\n        }\n        if (config_1.config.useDeprecatedSynchronousErrorHandling) {\n            if (sink.syncErrorThrowable) {\n                sink.syncErrorThrowable = false;\n                if (sink.syncErrorThrown) {\n                    throw sink.syncErrorValue;\n                }\n            }\n        }\n        return sink;\n    };\n    Observable.prototype._trySubscribe = function (sink) {\n        try {\n            return this._subscribe(sink);\n        }\n        catch (err) {\n            if (config_1.config.useDeprecatedSynchronousErrorHandling) {\n                sink.syncErrorThrown = true;\n                sink.syncErrorValue = err;\n            }\n            if (canReportError_1.canReportError(sink)) {\n                sink.error(err);\n            }\n            else {\n                console.warn(err);\n            }\n        }\n    };\n    Observable.prototype.forEach = function (next, promiseCtor) {\n        var _this = this;\n        promiseCtor = getPromiseCtor(promiseCtor);\n        return new promiseCtor(function (resolve, reject) {\n            var subscription;\n            subscription = _this.subscribe(function (value) {\n                try {\n                    next(value);\n                }\n                catch (err) {\n                    reject(err);\n                    if (subscription) {\n                        subscription.unsubscribe();\n                    }\n                }\n            }, reject, resolve);\n        });\n    };\n    Observable.prototype._subscribe = function (subscriber) {\n        var source = this.source;\n        return source && source.subscribe(subscriber);\n    };\n    Observable.prototype[observable_1.observable] = function () {\n        return this;\n    };\n    Observable.prototype.pipe = function () {\n        var operations = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            operations[_i] = arguments[_i];\n        }\n        if (operations.length === 0) {\n            return this;\n        }\n        return pipe_1.pipeFromArray(operations)(this);\n    };\n    Observable.prototype.toPromise = function (promiseCtor) {\n        var _this = this;\n        promiseCtor = getPromiseCtor(promiseCtor);\n        return new promiseCtor(function (resolve, reject) {\n            var value;\n            _this.subscribe(function (x) { return value = x; }, function (err) { return reject(err); }, function () { return resolve(value); });\n        });\n    };\n    Observable.create = function (subscribe) {\n        return new Observable(subscribe);\n    };\n    return Observable;\n}());\nexports.Observable = Observable;\nfunction getPromiseCtor(promiseCtor) {\n    if (!promiseCtor) {\n        promiseCtor = config_1.config.Promise || Promise;\n    }\n    if (!promiseCtor) {\n        throw new Error('no Promise impl found');\n    }\n    return promiseCtor;\n}\n//# sourceMappingURL=Observable.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar config_1 = require(\"./config\");\nvar hostReportError_1 = require(\"./util/hostReportError\");\nexports.empty = {\n    closed: true,\n    next: function (value) { },\n    error: function (err) {\n        if (config_1.config.useDeprecatedSynchronousErrorHandling) {\n            throw err;\n        }\n        else {\n            hostReportError_1.hostReportError(err);\n        }\n    },\n    complete: function () { }\n};\n//# sourceMappingURL=Observer.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Subscriber_1 = require(\"./Subscriber\");\nvar OuterSubscriber = (function (_super) {\n    __extends(OuterSubscriber, _super);\n    function OuterSubscriber() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    OuterSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n        this.destination.next(innerValue);\n    };\n    OuterSubscriber.prototype.notifyError = function (error, innerSub) {\n        this.destination.error(error);\n    };\n    OuterSubscriber.prototype.notifyComplete = function (innerSub) {\n        this.destination.complete();\n    };\n    return OuterSubscriber;\n}(Subscriber_1.Subscriber));\nexports.OuterSubscriber = OuterSubscriber;\n//# sourceMappingURL=OuterSubscriber.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar isFunction_1 = require(\"./util/isFunction\");\nvar Observer_1 = require(\"./Observer\");\nvar Subscription_1 = require(\"./Subscription\");\nvar rxSubscriber_1 = require(\"../internal/symbol/rxSubscriber\");\nvar config_1 = require(\"./config\");\nvar hostReportError_1 = require(\"./util/hostReportError\");\nvar Subscriber = (function (_super) {\n    __extends(Subscriber, _super);\n    function Subscriber(destinationOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        _this.syncErrorValue = null;\n        _this.syncErrorThrown = false;\n        _this.syncErrorThrowable = false;\n        _this.isStopped = false;\n        switch (arguments.length) {\n            case 0:\n                _this.destination = Observer_1.empty;\n                break;\n            case 1:\n                if (!destinationOrNext) {\n                    _this.destination = Observer_1.empty;\n                    break;\n                }\n                if (typeof destinationOrNext === 'object') {\n                    if (destinationOrNext instanceof Subscriber) {\n                        _this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;\n                        _this.destination = destinationOrNext;\n                        destinationOrNext.add(_this);\n                    }\n                    else {\n                        _this.syncErrorThrowable = true;\n                        _this.destination = new SafeSubscriber(_this, destinationOrNext);\n                    }\n                    break;\n                }\n            default:\n                _this.syncErrorThrowable = true;\n                _this.destination = new SafeSubscriber(_this, destinationOrNext, error, complete);\n                break;\n        }\n        return _this;\n    }\n    Subscriber.prototype[rxSubscriber_1.rxSubscriber] = function () { return this; };\n    Subscriber.create = function (next, error, complete) {\n        var subscriber = new Subscriber(next, error, complete);\n        subscriber.syncErrorThrowable = false;\n        return subscriber;\n    };\n    Subscriber.prototype.next = function (value) {\n        if (!this.isStopped) {\n            this._next(value);\n        }\n    };\n    Subscriber.prototype.error = function (err) {\n        if (!this.isStopped) {\n            this.isStopped = true;\n            this._error(err);\n        }\n    };\n    Subscriber.prototype.complete = function () {\n        if (!this.isStopped) {\n            this.isStopped = true;\n            this._complete();\n        }\n    };\n    Subscriber.prototype.unsubscribe = function () {\n        if (this.closed) {\n            return;\n        }\n        this.isStopped = true;\n        _super.prototype.unsubscribe.call(this);\n    };\n    Subscriber.prototype._next = function (value) {\n        this.destination.next(value);\n    };\n    Subscriber.prototype._error = function (err) {\n        this.destination.error(err);\n        this.unsubscribe();\n    };\n    Subscriber.prototype._complete = function () {\n        this.destination.complete();\n        this.unsubscribe();\n    };\n    Subscriber.prototype._unsubscribeAndRecycle = function () {\n        var _parentOrParents = this._parentOrParents;\n        this._parentOrParents = null;\n        this.unsubscribe();\n        this.closed = false;\n        this.isStopped = false;\n        this._parentOrParents = _parentOrParents;\n        return this;\n    };\n    return Subscriber;\n}(Subscription_1.Subscription));\nexports.Subscriber = Subscriber;\nvar SafeSubscriber = (function (_super) {\n    __extends(SafeSubscriber, _super);\n    function SafeSubscriber(_parentSubscriber, observerOrNext, error, complete) {\n        var _this = _super.call(this) || this;\n        _this._parentSubscriber = _parentSubscriber;\n        var next;\n        var context = _this;\n        if (isFunction_1.isFunction(observerOrNext)) {\n            next = observerOrNext;\n        }\n        else if (observerOrNext) {\n            next = observerOrNext.next;\n            error = observerOrNext.error;\n            complete = observerOrNext.complete;\n            if (observerOrNext !== Observer_1.empty) {\n                context = Object.create(observerOrNext);\n                if (isFunction_1.isFunction(context.unsubscribe)) {\n                    _this.add(context.unsubscribe.bind(context));\n                }\n                context.unsubscribe = _this.unsubscribe.bind(_this);\n            }\n        }\n        _this._context = context;\n        _this._next = next;\n        _this._error = error;\n        _this._complete = complete;\n        return _this;\n    }\n    SafeSubscriber.prototype.next = function (value) {\n        if (!this.isStopped && this._next) {\n            var _parentSubscriber = this._parentSubscriber;\n            if (!config_1.config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n                this.__tryOrUnsub(this._next, value);\n            }\n            else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) {\n                this.unsubscribe();\n            }\n        }\n    };\n    SafeSubscriber.prototype.error = function (err) {\n        if (!this.isStopped) {\n            var _parentSubscriber = this._parentSubscriber;\n            var useDeprecatedSynchronousErrorHandling = config_1.config.useDeprecatedSynchronousErrorHandling;\n            if (this._error) {\n                if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n                    this.__tryOrUnsub(this._error, err);\n                    this.unsubscribe();\n                }\n                else {\n                    this.__tryOrSetError(_parentSubscriber, this._error, err);\n                    this.unsubscribe();\n                }\n            }\n            else if (!_parentSubscriber.syncErrorThrowable) {\n                this.unsubscribe();\n                if (useDeprecatedSynchronousErrorHandling) {\n                    throw err;\n                }\n                hostReportError_1.hostReportError(err);\n            }\n            else {\n                if (useDeprecatedSynchronousErrorHandling) {\n                    _parentSubscriber.syncErrorValue = err;\n                    _parentSubscriber.syncErrorThrown = true;\n                }\n                else {\n                    hostReportError_1.hostReportError(err);\n                }\n                this.unsubscribe();\n            }\n        }\n    };\n    SafeSubscriber.prototype.complete = function () {\n        var _this = this;\n        if (!this.isStopped) {\n            var _parentSubscriber = this._parentSubscriber;\n            if (this._complete) {\n                var wrappedComplete = function () { return _this._complete.call(_this._context); };\n                if (!config_1.config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n                    this.__tryOrUnsub(wrappedComplete);\n                    this.unsubscribe();\n                }\n                else {\n                    this.__tryOrSetError(_parentSubscriber, wrappedComplete);\n                    this.unsubscribe();\n                }\n            }\n            else {\n                this.unsubscribe();\n            }\n        }\n    };\n    SafeSubscriber.prototype.__tryOrUnsub = function (fn, value) {\n        try {\n            fn.call(this._context, value);\n        }\n        catch (err) {\n            this.unsubscribe();\n            if (config_1.config.useDeprecatedSynchronousErrorHandling) {\n                throw err;\n            }\n            else {\n                hostReportError_1.hostReportError(err);\n            }\n        }\n    };\n    SafeSubscriber.prototype.__tryOrSetError = function (parent, fn, value) {\n        if (!config_1.config.useDeprecatedSynchronousErrorHandling) {\n            throw new Error('bad call');\n        }\n        try {\n            fn.call(this._context, value);\n        }\n        catch (err) {\n            if (config_1.config.useDeprecatedSynchronousErrorHandling) {\n                parent.syncErrorValue = err;\n                parent.syncErrorThrown = true;\n                return true;\n            }\n            else {\n                hostReportError_1.hostReportError(err);\n                return true;\n            }\n        }\n        return false;\n    };\n    SafeSubscriber.prototype._unsubscribe = function () {\n        var _parentSubscriber = this._parentSubscriber;\n        this._context = null;\n        this._parentSubscriber = null;\n        _parentSubscriber.unsubscribe();\n    };\n    return SafeSubscriber;\n}(Subscriber));\nexports.SafeSubscriber = SafeSubscriber;\n//# sourceMappingURL=Subscriber.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar isArray_1 = require(\"./util/isArray\");\nvar isObject_1 = require(\"./util/isObject\");\nvar isFunction_1 = require(\"./util/isFunction\");\nvar UnsubscriptionError_1 = require(\"./util/UnsubscriptionError\");\nvar Subscription = (function () {\n    function Subscription(unsubscribe) {\n        this.closed = false;\n        this._parentOrParents = null;\n        this._subscriptions = null;\n        if (unsubscribe) {\n            this._ctorUnsubscribe = true;\n            this._unsubscribe = unsubscribe;\n        }\n    }\n    Subscription.prototype.unsubscribe = function () {\n        var errors;\n        if (this.closed) {\n            return;\n        }\n        var _a = this, _parentOrParents = _a._parentOrParents, _ctorUnsubscribe = _a._ctorUnsubscribe, _unsubscribe = _a._unsubscribe, _subscriptions = _a._subscriptions;\n        this.closed = true;\n        this._parentOrParents = null;\n        this._subscriptions = null;\n        if (_parentOrParents instanceof Subscription) {\n            _parentOrParents.remove(this);\n        }\n        else if (_parentOrParents !== null) {\n            for (var index = 0; index < _parentOrParents.length; ++index) {\n                var parent_1 = _parentOrParents[index];\n                parent_1.remove(this);\n            }\n        }\n        if (isFunction_1.isFunction(_unsubscribe)) {\n            if (_ctorUnsubscribe) {\n                this._unsubscribe = undefined;\n            }\n            try {\n                _unsubscribe.call(this);\n            }\n            catch (e) {\n                errors = e instanceof UnsubscriptionError_1.UnsubscriptionError ? flattenUnsubscriptionErrors(e.errors) : [e];\n            }\n        }\n        if (isArray_1.isArray(_subscriptions)) {\n            var index = -1;\n            var len = _subscriptions.length;\n            while (++index < len) {\n                var sub = _subscriptions[index];\n                if (isObject_1.isObject(sub)) {\n                    try {\n                        sub.unsubscribe();\n                    }\n                    catch (e) {\n                        errors = errors || [];\n                        if (e instanceof UnsubscriptionError_1.UnsubscriptionError) {\n                            errors = errors.concat(flattenUnsubscriptionErrors(e.errors));\n                        }\n                        else {\n                            errors.push(e);\n                        }\n                    }\n                }\n            }\n        }\n        if (errors) {\n            throw new UnsubscriptionError_1.UnsubscriptionError(errors);\n        }\n    };\n    Subscription.prototype.add = function (teardown) {\n        var subscription = teardown;\n        if (!teardown) {\n            return Subscription.EMPTY;\n        }\n        switch (typeof teardown) {\n            case 'function':\n                subscription = new Subscription(teardown);\n            case 'object':\n                if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {\n                    return subscription;\n                }\n                else if (this.closed) {\n                    subscription.unsubscribe();\n                    return subscription;\n                }\n                else if (!(subscription instanceof Subscription)) {\n                    var tmp = subscription;\n                    subscription = new Subscription();\n                    subscription._subscriptions = [tmp];\n                }\n                break;\n            default: {\n                throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n            }\n        }\n        var _parentOrParents = subscription._parentOrParents;\n        if (_parentOrParents === null) {\n            subscription._parentOrParents = this;\n        }\n        else if (_parentOrParents instanceof Subscription) {\n            if (_parentOrParents === this) {\n                return subscription;\n            }\n            subscription._parentOrParents = [_parentOrParents, this];\n        }\n        else if (_parentOrParents.indexOf(this) === -1) {\n            _parentOrParents.push(this);\n        }\n        else {\n            return subscription;\n        }\n        var subscriptions = this._subscriptions;\n        if (subscriptions === null) {\n            this._subscriptions = [subscription];\n        }\n        else {\n            subscriptions.push(subscription);\n        }\n        return subscription;\n    };\n    Subscription.prototype.remove = function (subscription) {\n        var subscriptions = this._subscriptions;\n        if (subscriptions) {\n            var subscriptionIndex = subscriptions.indexOf(subscription);\n            if (subscriptionIndex !== -1) {\n                subscriptions.splice(subscriptionIndex, 1);\n            }\n        }\n    };\n    Subscription.EMPTY = (function (empty) {\n        empty.closed = true;\n        return empty;\n    }(new Subscription()));\n    return Subscription;\n}());\nexports.Subscription = Subscription;\nfunction flattenUnsubscriptionErrors(errors) {\n    return errors.reduce(function (errs, err) { return errs.concat((err instanceof UnsubscriptionError_1.UnsubscriptionError) ? err.errors : err); }, []);\n}\n//# sourceMappingURL=Subscription.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _enable_super_gross_mode_that_will_cause_bad_things = false;\nexports.config = {\n    Promise: undefined,\n    set useDeprecatedSynchronousErrorHandling(value) {\n        if (value) {\n            var error = new Error();\n            console.warn('DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \\n' + error.stack);\n        }\n        else if (_enable_super_gross_mode_that_will_cause_bad_things) {\n            console.log('RxJS: Back to a better error behavior. Thank you. <3');\n        }\n        _enable_super_gross_mode_that_will_cause_bad_things = value;\n    },\n    get useDeprecatedSynchronousErrorHandling() {\n        return _enable_super_gross_mode_that_will_cause_bad_things;\n    },\n};\n//# sourceMappingURL=config.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction getSymbolIterator() {\n    if (typeof Symbol !== 'function' || !Symbol.iterator) {\n        return '@@iterator';\n    }\n    return Symbol.iterator;\n}\nexports.getSymbolIterator = getSymbolIterator;\nexports.iterator = getSymbolIterator();\nexports.$$iterator = exports.iterator;\n//# sourceMappingURL=iterator.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.observable = (function () { return typeof Symbol === 'function' && Symbol.observable || '@@observable'; })();\n//# sourceMappingURL=observable.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.rxSubscriber = (function () {\n    return typeof Symbol === 'function'\n        ? Symbol('rxSubscriber')\n        : '@@rxSubscriber_' + Math.random();\n})();\nexports.$$rxSubscriber = exports.rxSubscriber;\n//# sourceMappingURL=rxSubscriber.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar UnsubscriptionErrorImpl = (function () {\n    function UnsubscriptionErrorImpl(errors) {\n        Error.call(this);\n        this.message = errors ?\n            errors.length + \" errors occurred during unsubscription:\\n\" + errors.map(function (err, i) { return i + 1 + \") \" + err.toString(); }).join('\\n  ') : '';\n        this.name = 'UnsubscriptionError';\n        this.errors = errors;\n        return this;\n    }\n    UnsubscriptionErrorImpl.prototype = Object.create(Error.prototype);\n    return UnsubscriptionErrorImpl;\n})();\nexports.UnsubscriptionError = UnsubscriptionErrorImpl;\n//# sourceMappingURL=UnsubscriptionError.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Subscriber_1 = require(\"../Subscriber\");\nfunction canReportError(observer) {\n    while (observer) {\n        var _a = observer, closed_1 = _a.closed, destination = _a.destination, isStopped = _a.isStopped;\n        if (closed_1 || isStopped) {\n            return false;\n        }\n        else if (destination && destination instanceof Subscriber_1.Subscriber) {\n            observer = destination;\n        }\n        else {\n            observer = null;\n        }\n    }\n    return true;\n}\nexports.canReportError = canReportError;\n//# sourceMappingURL=canReportError.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction hostReportError(err) {\n    setTimeout(function () { throw err; }, 0);\n}\nexports.hostReportError = hostReportError;\n//# sourceMappingURL=hostReportError.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction identity(x) {\n    return x;\n}\nexports.identity = identity;\n//# sourceMappingURL=identity.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isArray = (function () { return Array.isArray || (function (x) { return x && typeof x.length === 'number'; }); })();\n//# sourceMappingURL=isArray.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isArrayLike = (function (x) { return x && typeof x.length === 'number' && typeof x !== 'function'; });\n//# sourceMappingURL=isArrayLike.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction isFunction(x) {\n    return typeof x === 'function';\n}\nexports.isFunction = isFunction;\n//# sourceMappingURL=isFunction.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction isObject(x) {\n    return x !== null && typeof x === 'object';\n}\nexports.isObject = isObject;\n//# sourceMappingURL=isObject.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction isPromise(value) {\n    return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';\n}\nexports.isPromise = isPromise;\n//# sourceMappingURL=isPromise.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar identity_1 = require(\"./identity\");\nfunction pipe() {\n    var fns = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        fns[_i] = arguments[_i];\n    }\n    return pipeFromArray(fns);\n}\nexports.pipe = pipe;\nfunction pipeFromArray(fns) {\n    if (fns.length === 0) {\n        return identity_1.identity;\n    }\n    if (fns.length === 1) {\n        return fns[0];\n    }\n    return function piped(input) {\n        return fns.reduce(function (prev, fn) { return fn(prev); }, input);\n    };\n}\nexports.pipeFromArray = pipeFromArray;\n//# sourceMappingURL=pipe.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar subscribeToArray_1 = require(\"./subscribeToArray\");\nvar subscribeToPromise_1 = require(\"./subscribeToPromise\");\nvar subscribeToIterable_1 = require(\"./subscribeToIterable\");\nvar subscribeToObservable_1 = require(\"./subscribeToObservable\");\nvar isArrayLike_1 = require(\"./isArrayLike\");\nvar isPromise_1 = require(\"./isPromise\");\nvar isObject_1 = require(\"./isObject\");\nvar iterator_1 = require(\"../symbol/iterator\");\nvar observable_1 = require(\"../symbol/observable\");\nexports.subscribeTo = function (result) {\n    if (!!result && typeof result[observable_1.observable] === 'function') {\n        return subscribeToObservable_1.subscribeToObservable(result);\n    }\n    else if (isArrayLike_1.isArrayLike(result)) {\n        return subscribeToArray_1.subscribeToArray(result);\n    }\n    else if (isPromise_1.isPromise(result)) {\n        return subscribeToPromise_1.subscribeToPromise(result);\n    }\n    else if (!!result && typeof result[iterator_1.iterator] === 'function') {\n        return subscribeToIterable_1.subscribeToIterable(result);\n    }\n    else {\n        var value = isObject_1.isObject(result) ? 'an invalid object' : \"'\" + result + \"'\";\n        var msg = \"You provided \" + value + \" where a stream was expected.\"\n            + ' You can provide an Observable, Promise, Array, or Iterable.';\n        throw new TypeError(msg);\n    }\n};\n//# sourceMappingURL=subscribeTo.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.subscribeToArray = function (array) { return function (subscriber) {\n    for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {\n        subscriber.next(array[i]);\n    }\n    subscriber.complete();\n}; };\n//# sourceMappingURL=subscribeToArray.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar iterator_1 = require(\"../symbol/iterator\");\nexports.subscribeToIterable = function (iterable) { return function (subscriber) {\n    var iterator = iterable[iterator_1.iterator]();\n    do {\n        var item = void 0;\n        try {\n            item = iterator.next();\n        }\n        catch (err) {\n            subscriber.error(err);\n            return subscriber;\n        }\n        if (item.done) {\n            subscriber.complete();\n            break;\n        }\n        subscriber.next(item.value);\n        if (subscriber.closed) {\n            break;\n        }\n    } while (true);\n    if (typeof iterator.return === 'function') {\n        subscriber.add(function () {\n            if (iterator.return) {\n                iterator.return();\n            }\n        });\n    }\n    return subscriber;\n}; };\n//# sourceMappingURL=subscribeToIterable.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar observable_1 = require(\"../symbol/observable\");\nexports.subscribeToObservable = function (obj) { return function (subscriber) {\n    var obs = obj[observable_1.observable]();\n    if (typeof obs.subscribe !== 'function') {\n        throw new TypeError('Provided object does not correctly implement Symbol.observable');\n    }\n    else {\n        return obs.subscribe(subscriber);\n    }\n}; };\n//# sourceMappingURL=subscribeToObservable.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar hostReportError_1 = require(\"./hostReportError\");\nexports.subscribeToPromise = function (promise) { return function (subscriber) {\n    promise.then(function (value) {\n        if (!subscriber.closed) {\n            subscriber.next(value);\n            subscriber.complete();\n        }\n    }, function (err) { return subscriber.error(err); })\n        .then(null, hostReportError_1.hostReportError);\n    return subscriber;\n}; };\n//# sourceMappingURL=subscribeToPromise.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar InnerSubscriber_1 = require(\"../InnerSubscriber\");\nvar subscribeTo_1 = require(\"./subscribeTo\");\nvar Observable_1 = require(\"../Observable\");\nfunction subscribeToResult(outerSubscriber, result, outerValue, outerIndex, innerSubscriber) {\n    if (innerSubscriber === void 0) { innerSubscriber = new InnerSubscriber_1.InnerSubscriber(outerSubscriber, outerValue, outerIndex); }\n    if (innerSubscriber.closed) {\n        return undefined;\n    }\n    if (result instanceof Observable_1.Observable) {\n        return result.subscribe(innerSubscriber);\n    }\n    return subscribeTo_1.subscribeTo(result)(innerSubscriber);\n}\nexports.subscribeToResult = subscribeToResult;\n//# sourceMappingURL=subscribeToResult.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Subscriber_1 = require(\"../Subscriber\");\nvar rxSubscriber_1 = require(\"../symbol/rxSubscriber\");\nvar Observer_1 = require(\"../Observer\");\nfunction toSubscriber(nextOrObserver, error, complete) {\n    if (nextOrObserver) {\n        if (nextOrObserver instanceof Subscriber_1.Subscriber) {\n            return nextOrObserver;\n        }\n        if (nextOrObserver[rxSubscriber_1.rxSubscriber]) {\n            return nextOrObserver[rxSubscriber_1.rxSubscriber]();\n        }\n    }\n    if (!nextOrObserver && !error && !complete) {\n        return new Subscriber_1.Subscriber(Observer_1.empty);\n    }\n    return new Subscriber_1.Subscriber(nextOrObserver, error, complete);\n}\nexports.toSubscriber = toSubscriber;\n//# sourceMappingURL=toSubscriber.js.map","export type KeyOf<T> = T extends any ? keyof T : never;\r\nexport type Merge<T, K extends KeyOf<T> = KeyOf<T>> = { [k in K]: T[k] };\r\nexport type PromiseCtr = {\r\n  new <T>(executor: (resolve: (value?: T | PromiseLike<T>) => void, reject: (reason?: any) => void) => void): PromiseLike<T>;\r\n  all<T>(values: readonly (T | PromiseLike<T>)[]): PromiseLike<T[]>,\r\n  resolve<T>(value: T | PromiseLike<T>): PromiseLike<T>;\r\n  reject<T = never>(reason?: any): PromiseLike<T>;\r\n}\r\n\r\nexport const runit = <R, N>(gen: Generator<N | PromiseLike<N>, R, N>, promiseCtr: PromiseCtr) => {\r\n  const runThen = (...args: [] | [N]): PromiseLike<R> => {\r\n    const v = args.length ? gen.next(args[0]) : gen.next();\r\n    if (v.done) return promiseCtr.resolve(v.value);\r\n    return promiseCtr.resolve(v.value).then(runThen);\r\n  }; return runThen();\r\n}\r\n\r\nexport function* wait<T>(x: T | PromiseLike<T>): Generator<T | PromiseLike<T>, T, T> {\r\n  return yield x;\r\n}\r\n\r\nexport function asAsync<T extends any[], R, U = void, N = any>(f: (this: U, ...args: T) => Generator<N | PromiseLike<N>, R, N>, promiseCtr: PromiseCtr, thisArg: U): (...args: T) => PromiseLike<R>;\r\nexport function asAsync<T extends any[], R, U = void, N = any>(f: (this: U | void, ...args: T) => Generator<N | PromiseLike<N>, R, N>, promiseCtr: PromiseCtr, thisArg?: U): (...args: T) => PromiseLike<R>;\r\nexport function asAsync<T extends any[], R, U = void, N = any>(f: (this: U, ...args: T) => Generator<N | PromiseLike<N>, R, N>, promiseCtr: PromiseCtr, thisArg: U): (...args: T) => PromiseLike<R> {\r\n  return (...args: T) => runit(f.call(thisArg, ...args as T), promiseCtr);\r\n}\r\n\r\n\r\n\r\nexport const guard = <T, V extends T>(x: T, cond: boolean): x is V => cond;\r\nexport const toKeyOf = <V>(x: keyof V) => x as KeyOf<V>;\r\nexport class Keys<K extends string | symbol | number> {\r\n  readonly keys: K[];\r\n  private _!: { [k in K]: null };\r\n  constructor(o: { [k in K]: any }) { this.keys = Object.keys(o)/*.sort()*/ as K[]; }\r\n  mapTo<V extends { [k in K]: any }>(mapper: <k extends K>(k: k, i: number) => V[k]): Pick<V, K> {\r\n    const object = {} as Pick<V, K>;\r\n    this.keys.forEach((k, i) => object[k] = mapper(k, i));\r\n    return object;\r\n  }\r\n  asyncMapTo<V extends { [k in K]: any }>(mapper: <k extends K>(k: k) => PromiseLike<V[k]>, promiseCtr: PromiseCtr): PromiseLike<Pick<V, K>> {\r\n    const object = {} as Pick<V, K>;\r\n    return promiseCtr.all(this.keys.map(k => mapper(k).then(v => object[k] = v))).then(() => object);\r\n  }\r\n}\r\n","import { Observable } from \"rxjs\";\r\nimport { ValuedSubject, of } from '../valued-observable';\r\nimport { KeyOf, Merge } from \"../common\";\r\n\r\n\r\n/** \r\n * Entity base class\r\n * @template T map of fields output types\r\n * @template V map of fields input types\r\n */\r\nexport abstract class EntityAbstract<T, V extends T> {\r\n  /** `function` that returns the `ValuedSubject` for the givin `field` */\r\n  abstract readonly rx: EntityFieldsFct<T, V>;\r\n  /** `map` that stores the `ValuedSubject` for all the entity `fields` */\r\n  abstract readonly rxMap: Readonly<EntityFieldsMap<T, V>>;\r\n  /** a `getter` snapshot for the *local* `fields` */\r\n  abstract readonly local: Partial<Merge<T>>;\r\n\r\n  /** a `getter` snapshot for all the entity `fields` */\r\n  get snapshot() {\r\n    const snapshot = {} as Merge<T>;\r\n    const rx = this.rx;\r\n    for (const k of Object.keys(this.rxMap) as KeyOf<T>[]) {\r\n      snapshot[k] = rx(k).value;\r\n    }\r\n    return snapshot;\r\n  }\r\n\r\n  /** updates some fields of the entity */\r\n  readonly update = <K extends KeyOf<T>>(e: { [k in K]: V[k] }) => {\r\n    const rx = this.rx;\r\n    (Object.keys(e) as K[]).forEach(<k extends K>(k: k) => {\r\n      rx(k).next(e[k]);\r\n    });\r\n  };\r\n\r\n  /** undo local changes in the entity */\r\n  readonly rewind = <K extends keyof T>(_field?: K) => { };\r\n\r\n  /** define the parent of the entity */\r\n  readonly setParent = () => { };\r\n\r\n  /** get the number of entities between the actual and the source of the field */\r\n  readonly levelOf = <K extends KeyOf<T>>(_field: K) => of(0);\r\n}\r\n\r\n/** `function` that associates to each key of an entity a `ValuedSubject` */\r\nexport type EntityFieldsFct<T, V extends T = T> = {\r\n  <k extends KeyOf<T>>(k: k): ValuedSubject<T[k], V[k]>;\r\n};\r\n\r\n/** `map` that associates to each key of an entity a `ValuedSubject` */\r\nexport type EntityFieldsMap<T, V extends T = T> = {\r\n  [k in KeyOf<T>]: ValuedSubject<T[k], V[k]>\r\n};\r\n\r\n","import { BehaviorSubject, identity } from \"rxjs\";\r\nimport { EntityFieldsFct, EntityFieldsMap, EntityAbstract } from \"./entity-abstract\";\r\nimport { altern, ValuedSubject, map, of } from \"../valued-observable\";\r\nimport { Entity } from \"./entity-proxies\";\r\nimport { guard, KeyOf, Merge, toKeyOf } from \"../common\";\r\n\r\n/** \r\n * Child entity class\r\n * @template T map of fields output types\r\n * @template P map of fields parent output types\r\n * @template V map of fields input types\r\n * @template K union of initial field keys\r\n */\r\nexport class ChildEntityImpl<T, P extends T, V extends T, K extends KeyOf<T>> extends EntityAbstract<T, V> {\r\n  readonly rx: EntityFieldsFct<T, V> = <k extends KeyOf<T>>(k: k) => {\r\n    return this.rxMap[k] || (this.rxMap[k] = this.createRx(k));\r\n  };\r\n  private createRx<k extends KeyOf<T>>(k: k): ValuedSubject<T[k], V[k]> {\r\n    const rxSource: ValuedSubject<ValuedSubject<T[k], V[k]>> = this.rxSource(k);\r\n    return Object.assign(altern(rxSource, identity), {\r\n      next: (x: V[k]) => this._parent && rxSource.value === this._parent.rx(k)\r\n        ? rxSource.next(new BehaviorSubject<T[k]>(x))\r\n        : rxSource.value.next(x)\r\n    });\r\n  }\r\n  readonly rxMap: EntityFieldsMap<T, V>;\r\n  private rxSource = <k extends KeyOf<T>>(k: k) => {\r\n    return this.rxSourceMap[k] || (\r\n      this.rxSourceMap[k] = new BehaviorSubject<ValuedSubject<T[k], V[k]>>(this._parent\r\n        ? this._parent.rx(k)\r\n        : new BehaviorSubject<V[k]>(undefined as any)\r\n      )\r\n    );\r\n  };\r\n  private rxSourceMap: { [k in keyof T]: BehaviorSubject<ValuedSubject<T[k], V[k]>> };\r\n  private _parent: Entity<P, any> | undefined = undefined;\r\n  get parent() { return this._parent; };\r\n\r\n  get local() {\r\n    if (!this._parent) return this.snapshot;\r\n    const parent = this._parent;\r\n    const snapshot: Partial<Merge<T>> = {};\r\n    const rxSourceMap = this.rxSourceMap;\r\n    for (const k of Object.keys(rxSourceMap) as KeyOf<T>[]) {\r\n      const source = rxSourceMap[k].value;\r\n      if (source !== parent.rxMap[k]) snapshot[k] = source.value;\r\n    }\r\n    return snapshot;\r\n  }\r\n\r\n  constructor(params: {\r\n    data: V;\r\n    parentPromise: { then: (setParent: (parent: Entity<P, any>) => void) => void; };\r\n    parent?: undefined;\r\n  } | {\r\n    data: { [k in K]: V[k] }; \r\n    parent: Entity<P, any>;\r\n  }) {\r\n    super();\r\n    const rxMap = this.rxMap = {} as EntityFieldsMap<T, V>;\r\n    const rxSourceMap = this.rxSourceMap = {} as { [k in keyof T]: BehaviorSubject<ValuedSubject<T[k], V[k]>> };\r\n    let keys: KeyOf<T>[];\r\n    if (params.parent === undefined) {\r\n      const { data, parentPromise } = params;\r\n      keys = Object.keys(data) as KeyOf<T>[];\r\n      parentPromise.then(this.setParent);\r\n      keys.forEach(<k extends keyof T>(k: k) => {\r\n        rxSourceMap[k] = new BehaviorSubject<ValuedSubject<T[k], V[k]>>(new BehaviorSubject(data[k] as T[k]));\r\n      });\r\n    } else {\r\n      const { data, parent } = params;\r\n      this._parent = parent;\r\n      keys = Object.keys(parent.rxMap) as KeyOf<T>[];\r\n      keys.forEach(<k extends KeyOf<T>>(k: k) => {\r\n        const next: ValuedSubject<T[k], V[k]> = guard<keyof T, K>(k, k in data)\r\n          ? new BehaviorSubject(data[k] as V[k])\r\n          : parent.rx(k);\r\n        rxSourceMap[k] = new BehaviorSubject(next);\r\n      });\r\n    }\r\n    keys.forEach(<k extends KeyOf<T>>(k: k) => rxMap[k] = this.createRx(k));\r\n  }\r\n\r\n  setParent = (parent?: Entity<P, any>) => {\r\n    const oldParent = this.parent;\r\n    this._parent = parent;\r\n    const rxSourceMap = this.rxSourceMap;\r\n    if (parent) (Object.keys(rxSourceMap) as KeyOf<T>[]).forEach(<k extends KeyOf<T>>(k: k) => {\r\n      if (rxSourceMap[k].value === undefined) {\r\n        rxSourceMap[k].next(parent.rx(k));\r\n      }\r\n    });\r\n    if (!oldParent) return;\r\n    (Object.keys(oldParent.rxMap) as KeyOf<T>[]).forEach(<k extends KeyOf<T>>(k: k) => {\r\n      if (rxSourceMap[k]?.value === oldParent.rxMap[k]) {\r\n        if (parent) rxSourceMap[k].next(parent.rx(k));\r\n        else {\r\n          rxSourceMap[k].next(new BehaviorSubject<T[k]>(oldParent.rxMap[k].value));\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  readonly rewind = <K extends keyof T>(field?: K) => {\r\n    const parent = this._parent;\r\n    if (!parent) return;\r\n    (field ? [toKeyOf<T>(field)] : Object.keys(this.rxSourceMap) as KeyOf<T>[]).forEach(\r\n      field => this.rxSource(field).next(parent.rx(field))\r\n    );\r\n  };\r\n\r\n  readonly levelOf = <K extends KeyOf<T>>(field: K) => altern(this.rxSource(field), \r\n    src => src === this._parent?.rxMap[field] ? map(this._parent.levelOf(field), l => l + 1) : of(0)\r\n  );\r\n}\r\n","import { BehaviorSubject } from \"rxjs\";\r\nimport { KeyOf } from \"../common\";\r\nimport { EntityAbstract, EntityFieldsFct, EntityFieldsMap } from \"./entity-abstract\";\r\n\r\n/** \r\n * Top level entity class\r\n * @template T map of fields output types\r\n * @template V map of fields input types\r\n */\r\nexport class EntityImpl<T, V extends T> extends EntityAbstract<T, V> {\r\n  readonly rx: EntityFieldsFct<T, V> = <k extends KeyOf<T>>(k: k) => {\r\n    return this.rxMap[k] || (this.rxMap[k] = new BehaviorSubject<V[k]>(undefined as any));\r\n  };\r\n  readonly rxMap: EntityFieldsMap<T, V>;\r\n  get local() { return this.snapshot; }\r\n  constructor(e: V) {\r\n    super();\r\n    const rxMap = this.rxMap = {} as EntityFieldsMap<V>;\r\n    (Object.keys(e) as KeyOf<V>[]).forEach(k => {\r\n      rxMap[k as keyof V as KeyOf<V>] = new BehaviorSubject(e[k as keyof V as KeyOf<V>])\r\n    })\r\n  }\r\n};\r\n","import { alternMap } from \"altern-map\";\r\nimport { Observable } from \"rxjs\";\r\nimport { guard, KeyOf } from \"../common\";\r\nimport { EntityAbstract } from \"./entity-abstract\";\r\nimport { ValuedSubject } from \"../valued-observable\";\r\n\r\n/** \r\n * Proxified entity type\r\n * @template T map of fields output types\r\n * @template V map of fields input types\r\n */\r\nexport type Entity<T, V extends T, E = EntityAbstract<T, V>> = E & {\r\n  readonly [k in Exclude<KeyOf<T>, keyof E>]: ValuedSubject<T[k], V[k]>\r\n};\r\n\r\n/** \r\n * Proxified entity observable, subscribing to it keeps entity in the store\r\n * @template T map of fields output types\r\n * @template V map of fields input types\r\n */\r\nexport type EntityFlow<T, V extends T> = {\r\n  readonly [k in Exclude<KeyOf<T>, 'observable' | 'field' | 'unsubscribe'>]: Observable<T[k]>;\r\n} & {\r\n  observable: Observable<Entity<T, V>>;\r\n  field: { readonly [k in KeyOf<T>]: Observable<T[k]> };\r\n};\r\n\r\n/** Extracts the field observable from the entity flow */\r\nconst fieldRX = <T, V extends T, K extends KeyOf<T>>(entity: Observable<Entity<T, V>>, field: K): Observable<T[K]> => {\r\n  return entity.pipe(alternMap(e => e.rx(field)));\r\n};\r\n\r\n/** \r\n * Creates an `EntityFlow` from an observable\r\n * @param observable the observable being proxified\r\n * @param {Record<Observable>} [field] optional external impl of the field observables proxy\r\n * @see {EntityFlow}\r\n */\r\nexport const entityFlow = <T, V extends T>(\r\n  observable: Observable<Entity<T, V>>,\r\n  field?: EntityFlow<T, V>['field']\r\n): EntityFlow<T, V> => new Proxy({} as any as EntityFlow<T, V>, {\r\n  get(_target: EntityFlow<T, V>, key: keyof EntityFlow<T, V>) {\r\n    if (key === 'observable') return observable;\r\n    if (key === 'field') return field || (field = new Proxy({} as EntityFlow<T, V>['field'], {\r\n      get<k extends KeyOf<T>>(_: EntityFlow<T, V>['field'], k: k) { return fieldRX(observable, k); }\r\n    }));\r\n    return fieldRX(observable, key);\r\n  }\r\n});\r\n\r\n\r\n/** \r\n * Creates a proxified `Entity` from an `EntityAbstract`\r\n * @see {Entity}\r\n */\r\nexport const toEntity = <T, V extends T, E extends EntityAbstract<T, V>>(entity: EntityAbstract<T, V> & E) => new Proxy<Entity<T, V, E>>(entity as Entity<T, V, E>, {\r\n  get(target, key: keyof Entity<T, V, E>) {\r\n    const k: keyof any = key;\r\n    return guard<typeof key, keyof E>(key, k in entity) ? target[key] : target.rx(key);\r\n  }\r\n});\r\n","export * from './entity-abstract';\r\nexport * from './entity-child-impl';\r\nexport * from './entity-impl';\r\nexport * from './entity-proxies';\r\n","export * from './entity';\r\nexport * from './list';\r\nexport * from './common';\r\nexport * from './store';\r\nexport * from './valued-observable';","export * from './stored-list';\r\nexport * from './types';","import { Subscription, Observable, Subscriber, ReplaySubject, from } from 'rxjs';\r\nimport { shareReplay } from 'rxjs/operators';\r\nimport { Entity } from '../entity';\r\nimport { Stores, Entities, EntitiesFlow, ListStatus, EntityList } from './types';\r\nimport { asAsync, Keys, PromiseCtr, wait } from '../common'\r\n\r\ntype EntityWithSubscrition<T, V extends T> = { entity: Entities<T, V>, subscription: Subscription; };\r\n\r\ntype Params<K extends Pick<any, keyof T>, key extends keyof T, T, V extends T = T, P extends T = never> = {\r\n  /** \r\n   * Retrieve function\r\n   * @returns {PromiseLike<{ done?: boolean, data: V[]; }>} `done` is undefined means information is not available, check parent\r\n   */\r\n  retrieve: (first?: Entities<T, any>, last?: Entities<T, any>) => PromiseLike<{ done?: boolean, data: V[]; }>,\r\n  stores: Stores<K, T, P, V>,\r\n  key: key,\r\n  keyof: <k extends keyof T>(k: k, data: V[k]) => K[k],\r\n  keyofEntity: <k extends keyof T>(k: k, data: Entity<T[k], V[k]>) => K[k],\r\n  merge: (key: key, list1: EntityWithSubscrition<T, V>[], list2: EntityWithSubscrition<T, V>[]) => EntityWithSubscrition<T, V>[],\r\n  parent?: EntityList<K, Pick<P, keyof T>, any>,\r\n  promiseCtr: PromiseCtr,\r\n};\r\n\r\nexport class StoredList<K extends Pick<any, keyof T>, key extends keyof T, T, V extends T = T, P extends T = never> implements EntityList<K, T, V> {\r\n  private parentSubsctiption?: Subscription;\r\n  private retrieve: (first?: Entities<T, any>, last?: Entities<T, any>, err?: any) => PromiseLike<{ done?: boolean, data: Pick<V, keyof T>[]; }>;\r\n  /** list is null when `entities` has no subscription */\r\n  private list: { data: EntityWithSubscrition<T, V>[], status: ListStatus; } | null = null;\r\n  private subscriber: Subscriber<{ list: Entities<T, V>[], status: ListStatus; }> | null = null;\r\n  private donePromises: (PromiseLike<ListStatus> | undefined)[] = [];\r\n  readonly key: key;\r\n  readonly merge: (key: key, list1: EntityWithSubscrition<T, V>[], list2: EntityWithSubscrition<T, V>[]) => EntityWithSubscrition<T, V>[];\r\n  readonly parent?: EntityList<K, Pick<P, keyof T>, any>;\r\n  readonly keys: Keys<keyof T>;\r\n  readonly stores: Stores<K, T, any, V>;\r\n  readonly keyof: <k extends keyof T>(k: k, data: V[k]) => K[k];\r\n  readonly keyofEntity: <k extends keyof T>(k: k, data: Entity<T[k], V[k]>) => K[k];\r\n  readonly promiseCtr: PromiseCtr;\r\n  /**\r\n   * @param {Params} params \r\n   */\r\n  constructor(params: Params<K, key, T, V, P>) {\r\n    const { key, merge, retrieve, parent, keyof, keyofEntity, stores, promiseCtr } = params;\r\n    this.keyof = keyof;\r\n    this.keyofEntity = keyofEntity;\r\n    this.stores = stores;\r\n    this.keys = new Keys(stores);\r\n    this.retrieve = retrieve;\r\n    this.key = key;\r\n    this.merge = merge;\r\n    this.parent = parent;\r\n    this.promiseCtr = promiseCtr;\r\n  }\r\n\r\n  add(entity: Entities<T, V>) {\r\n    const key = this.key;\r\n    const id = this.keyofEntity(key, entity[key]);\r\n    if (this.list === null || this.list.data.find(e => this.keyofEntity(key, e.entity[key]) === id)) return;\r\n    const subscription = new Subscription();\r\n    const stores = this.stores;\r\n    new Keys(entity).keys.forEach(k => {\r\n      subscription.add(stores[k].get(id).observable.subscribe());\r\n    });\r\n    this.list = { data: [{ entity, subscription }, ...this.list.data], status: this.list.status };\r\n    this.subscriber?.next({ list: this.list.data.map(e => e.entity), status: this.list.status });\r\n  }\r\n\r\n  remove(entity: Entities<T, V>) {\r\n    if (this.list === null) return;\r\n    const index = this.list.data.findIndex(e => e.entity === entity);\r\n    if (index !== -1) {\r\n      const list = this.list;\r\n      list.data[index].subscription.unsubscribe();\r\n      list.data.splice(index, 1);\r\n      this.subscriber?.next({ list: list.data.map(e => e.entity), status: list.status });\r\n    }\r\n  }\r\n\r\n  protected toPromise(flowList: EntitiesFlow<T, V>[]): PromiseLike<EntityWithSubscrition<T, V>[]> {\r\n    return this.promiseCtr.all(flowList.map(async entitiesFlow => {\r\n      const subscription = new Subscription();\r\n      return {\r\n        subscription, entity: await this.keys.asyncMapTo<{ [k in keyof T]: Entity<T[k], V[k]> }>(\r\n          <k extends keyof T>(k: k) => new this.promiseCtr<Entity<T[k], V[k]>>(\r\n            res => entitiesFlow[k].observable.subscribe(res)\r\n          ), this.promiseCtr\r\n        )\r\n      };\r\n    }));\r\n  }\r\n\r\n  private _status(child: ListStatus, parent: ListStatus) {\r\n    return child === null ? null : child ?? parent;\r\n  }\r\n\r\n  private parentSubscriber = () => new this.promiseCtr<ListStatus>((resolve, reject) => {\r\n    this.parentSubsctiption = this.parent?.entities.subscribe(async parentList => {\r\n      const key = this.key;\r\n      const flowList: EntitiesFlow<T, V>[]\r\n        = parentList.list.map(e => this.keys.mapTo<EntitiesFlow<T, V>>(\r\n          k => this.stores[k].get(this.keyofEntity(k, e[k]))));\r\n      const entitiesSet = new Set(this.list?.data.map(u => u.entity[key]));\r\n      const parentEntities = await this.toPromise(flowList);\r\n\r\n      const newIds = parentEntities.filter(e => !entitiesSet.has(e.entity[key])).map(\r\n        e => this.keys.mapTo<K>(k => this.keyofEntity(k, e.entity[k]))\r\n      );\r\n      // console.log('newIds', newIds, this.store);\r\n      const newEntities: EntityWithSubscrition<T, V>[] = await this.toPromise(newIds.map(id => this.keys.mapTo(\r\n        <k extends keyof T>(k: k) => this.stores[k].get(id[k])\r\n      )));\r\n      // unsubscribe after new subscription made to reuse recently created entities\r\n      parentEntities.forEach(s => s.subscription.unsubscribe());\r\n      if (!this.list) return reject();\r\n      const newList = this.merge(key, this.list.data, newEntities);\r\n      this.list = { data: newList, status: this._status(this.list.status, parentList.status) };\r\n      this.subscriber?.next({ list: this.list.data.map(({ entity }) => entity), status: this.list.status });\r\n      return resolve(this.list.status);\r\n    });\r\n  });\r\n\r\n  readonly entities = new Observable<{ list: Entities<T, V>[], status: ListStatus; }>(subscriber => {\r\n    console.log('+++ subscribing', this.stores);\r\n    this.list = { data: [], status: undefined };\r\n    this.subscriber = subscriber;\r\n    this.reload();\r\n    return () => {\r\n      this.parentSubsctiption?.unsubscribe();\r\n      this.parentSubsctiption = undefined;\r\n      this.subscriber = null;\r\n      this.list?.data.forEach(e => e.subscription.unsubscribe());\r\n      this.list = null;\r\n      console.log('xxx unsubscribed', this.stores);\r\n    };\r\n  }).pipe(shareReplay({ bufferSize: 1, refCount: true }));\r\n\r\n  private _populate(retrieved: Pick<V, keyof T>[]): PromiseLike<EntityWithSubscrition<T, V>[]> {\r\n    const flowList = retrieved.map(p => this.keys.mapTo(k => this.stores[k].get(this.keyof(k, p[k]))));\r\n    const entitiesPromise = this.toPromise(flowList);\r\n    this.keys.keys.forEach(k => this.stores[k].nextBulk(retrieved.map(p => ({ id: this.keyof(k, p[k]), data: p[k] }))));\r\n    return entitiesPromise;\r\n  }\r\n\r\n  reload(err?: any): PromiseLike<ListStatus> {\r\n    return this.exec(0, err);\r\n  }\r\n  more(err?: any): PromiseLike<ListStatus> {\r\n    return this.exec(1, err);\r\n  }\r\n\r\n  private _setDone<V>(n: number, done: PromiseLike<ListStatus>[], v: V | null): v is V {\r\n    if (v === null) {\r\n      done[0] = this.promiseCtr.resolve(true);\r\n      return false;\r\n    }\r\n    if (n > 0) {\r\n      const prev = this.donePromises[n - 1];\r\n      if (prev) {\r\n        done[0] = prev;\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  exec(n: number, err: any, from?: Entities<T, V>, to?: Entities<T, V>): PromiseLike<ListStatus> {\r\n    return (this.donePromises[n] || (this.donePromises[n] = this._exec(n, err, from, to)));\r\n  }\r\n\r\n  private _exec = (n: number, err: any, from?: Entities<T, V>, to?: Entities<T, V>): PromiseLike<ListStatus> => asAsync(function* () {\r\n    let done: PromiseLike<ListStatus>[] = [];\r\n    try {\r\n      console.log('1', n, this.stores[this.key]);\r\n      if (!this._setDone(n, done, this.list)) return yield* wait(done[0]);\r\n      console.log('2', n, this.stores[this.key]);\r\n      const oldList = n ? this.list.data : [];\r\n      [from, to] = [from || oldList[0]?.entity, to || oldList[oldList.length - 1]?.entity];\r\n      const retrieved = yield* wait(this.retrieve(from, to, err));\r\n      console.log('3', n, this.stores[this.key]);\r\n      if (!this._setDone(n, done, this.list)) return yield* wait(done[0]);\r\n      console.log('4', n, this.stores[this.key]);\r\n      const list = yield* wait(this._populate(retrieved.data));\r\n      console.log('5', n, this.stores[this.key]);\r\n      if (!this._setDone(n, done, this.list)) return yield* wait(done[0]);\r\n      console.log('6', n, this.stores[this.key]);\r\n      // if reload, unsubscribe from old entities\r\n      if (!n) this.list.data.forEach(e => e.subscription.unsubscribe());\r\n      this.list = { data: oldList.concat(list), status: retrieved.done };\r\n      if (retrieved.done === undefined && this.parent) try {\r\n        const parentDone = yield* wait(this.parentSubsctiption ? this.parent.exec(n, null) : this.parentSubscriber());\r\n        console.log('7u', n, this.stores[this.key], parentDone);\r\n        return parentDone;\r\n      } catch (e) {\r\n        // unsubscribed while retrieving data from parent\r\n        return true;\r\n      } else {\r\n        this.subscriber!.next({ list: this.list.data.map(e => e.entity), status: this.list.status });\r\n        console.log('7', n, this.stores[this.key]);\r\n        return retrieved.done;\r\n      }\r\n    } catch (e) {\r\n      console.log('8', n, this.stores[this.key]);\r\n      if (!this._setDone(n, done, this.list)) return yield* wait(done[0]);\r\n      console.log('9', n, this.stores[this.key]);\r\n      this.list.status = null;\r\n      if (!this.parent) throw e;\r\n      console.log('10', n, this.stores[this.key]);\r\n      try {\r\n        const parentDone = yield* wait(this.parentSubsctiption ? this.parent.exec(n, e) : this.parentSubscriber());\r\n        console.log('11', n, this.stores[this.key], parentDone);\r\n        return this._status(null, parentDone);\r\n      } catch (e) {\r\n        // unsubscribed while retrieving data from parent\r\n        return true;\r\n      }\r\n    } finally {\r\n      console.log('12', n, this.stores[this.key]);\r\n      this.donePromises[n] = undefined;\r\n    }\r\n  }, this.promiseCtr, this)()\r\n}\r\n","import { Observable, TeardownLogic, Subscriber, Subscription, Subject } from 'rxjs';\r\nimport { KeyOf, PromiseCtr } from './common';\r\nimport { EntityFlow, Entity, ChildEntityImpl, EntityImpl, entityFlow, toEntity, EntityAbstract } from \"./entity\";\r\n\r\ninterface IStore<K, T, V extends T> {\r\n  get(id: K, skipCurrent?: true): EntityFlow<T, V>;\r\n}\r\n\r\n\r\nexport class Store<K, T, P extends T = never, V extends T = T> implements IStore<K, T, V> {\r\n  private _items = new Map<K, {\r\n    id: K, observers: Subscriber<Entity<T, V>>[], entity?: Entity<T, V>,\r\n    next?: PromiseLike<void>, parentSubscription?: Subscription, closed?: true, ready?: true;\r\n  }>();\r\n  readonly insersions = new Subject<K[]>();\r\n  readonly emptyInsersions = new Subject<K>();\r\n\r\n  constructor(\r\n    readonly name: string,\r\n    private finalize: (id: K, entity: Entity<T, V>) => void,\r\n    readonly promiseCtr: PromiseCtr,\r\n    readonly parent: IStore<K, P, any> | null = null,\r\n  ) { }\r\n\r\n  rewind(id: K) {\r\n    const item = this._items.get(id);\r\n    item?.entity?.rewind();\r\n  }\r\n  /**\r\n   * Ensures the existance of an entity with a givin id using a givin construction logic\r\n   * @param id id of the item to be prepared\r\n   * @param handler the asynchronous function to be executed in order to prepare the item\r\n   * @returns an observable that holds the logic behind the entity construction\r\n   */\r\n  prepare(\r\n    id: K,\r\n    handler: (\r\n      id: K, item: { readonly ready?: true; },\r\n      join: (subsciption: Subscription) => void\r\n    ) => void | PromiseLike<void>\r\n  ): Observable<Entity<T, V>> {\r\n    const entityFlow = this.get(id);\r\n    return new Observable<Entity<T, V>>(subscriber => {\r\n      const subsciption = entityFlow.observable.subscribe(subscriber);\r\n      const item = this._items.get(id);\r\n      if (!item) return; // assert item is not null (unless id has changed)\r\n      // if the item exists but not because of `prepare` call, execute the handler anyway\r\n      const next = item.next = (item.next || {\r\n        then: (_: void, catcher: () => void) => {\r\n          try { return this.promiseCtr.resolve(catcher()); } catch (e) { return this.promiseCtr.reject(e); }\r\n        }\r\n      }).then(undefined, () => {\r\n        const i = item;\r\n        if (!item.closed && !item.ready) {\r\n          return handler(item.id, { get ready() { return i.ready } }, subs => subsciption.add(subs));\r\n        }\r\n      });\r\n      next.then(undefined, () => { });\r\n      return subsciption;\r\n    });\r\n  }\r\n\r\n  nextBulk(items: { id: K, data: V; }[]) {\r\n    const insersions = items.filter(({ id, data }) => this._next(id, data)).map(({ id }) => id);\r\n    this.insersions.next(insersions);\r\n  }\r\n\r\n  next(id: K, data: V) {\r\n    if (this._next(id, data)) this.insersions.next([id]);\r\n  }\r\n\r\n  private _next(id: K, data: V) {\r\n    const item = this._items.get(id);\r\n    if (!item) return;\r\n    if (item.entity) {\r\n      item.entity.update(data);\r\n      item.ready = true;\r\n      return false;\r\n    } else {\r\n      if (this.parent) {\r\n        const parentFlow = this.parent.get(id);\r\n        item.entity = toEntity<T, V, EntityAbstract<T, V>>(new ChildEntityImpl<T, P, V, KeyOf<T>>({\r\n          data, parentPromise: {\r\n            then: (setParent: (parent: Entity<P, any>) => void) => {\r\n              const subscription = parentFlow.observable.subscribe(parent => setParent(parent));\r\n              item.parentSubscription?.unsubscribe();\r\n              item.parentSubscription = subscription;\r\n            }\r\n          }\r\n        }));\r\n      } else {\r\n        item.entity = toEntity(new EntityImpl<T, V>(data));\r\n      }\r\n      const entity: Entity<T, V> = item.entity;\r\n      item.ready = true;\r\n      item.observers.forEach(subscriber => subscriber.next(entity));\r\n      return true;\r\n    }\r\n  }\r\n\r\n  updateId(oldId: K, newId: K) {\r\n    /** @TODO consider when newId is taken */\r\n    if (this._items.get(newId)) throw new Error('New Id \"' + newId + '\" is taken');\r\n    const item = this._items.get(oldId);\r\n    if (!item) return;\r\n    item.id = newId;\r\n    this._items.delete(oldId);\r\n    this._items.set(newId, item);\r\n    item.entity?.setParent();\r\n    item.parentSubscription?.unsubscribe();\r\n    if (this.parent) {\r\n      const parentFlow = this.parent.get(newId);\r\n      if (item.entity instanceof ChildEntityImpl) {\r\n        const entity = item.entity as ChildEntityImpl<T, P, V, KeyOf<T>>;\r\n        item.parentSubscription = parentFlow.observable.subscribe(parent => {\r\n          entity.setParent(parent);\r\n        });\r\n      }\r\n    }\r\n    // keep the locks in their places\r\n  }\r\n\r\n  // remove(id: K); use a `deleted` field instead\r\n\r\n  update<M extends KeyOf<T>>(id: K, data: Pick<V, M>) {\r\n    this._items.get(id)?.entity?.update(data);\r\n  }\r\n\r\n  private item(id: K, observer: Subscriber<Entity<T, V>>) {\r\n    let item = this._items.get(id);\r\n    if (!item) this._items.set(id, item = { id, observers: [observer] });\r\n    else item.observers.push(observer);\r\n    return item;\r\n  }\r\n\r\n  get(id: K, skipCurrent?: true): EntityFlow<T, V> {\r\n    return entityFlow(new Observable((subscriber: Subscriber<Entity<T, V>>): TeardownLogic => {\r\n      const item = this.item(id, subscriber);\r\n      const observers = item.observers;\r\n      if (item.entity) {\r\n        if (!skipCurrent) subscriber.next(item.entity);\r\n      } else {\r\n        if (this.parent && !item.parentSubscription) {\r\n          let run = !skipCurrent;\r\n          // this._entities.set will not be runned when .next is invoked because it will be already unsubscribed\r\n          item.parentSubscription = this.parent.get(id).observable.subscribe(parent => {\r\n            item.entity = toEntity<T, V, EntityAbstract<T, V>>(new ChildEntityImpl<T, P, V, never>({ data: {}, parent }));\r\n            this.emptyInsersions.next(item.id);\r\n            if (run) observers.forEach(subscriber => subscriber.next(item.entity));\r\n          });\r\n          run = true;\r\n        }\r\n      }\r\n      return () => {\r\n        const id = item.id, i = observers.indexOf(subscriber);\r\n        if (i !== -1) observers.splice(i, 1);\r\n        if (!observers.length) {\r\n          const subscription = item.parentSubscription;\r\n          this._items.delete(id);\r\n          item.closed = true;\r\n          // debugger;\r\n          if (item.entity) {\r\n            this.finalize(id, item.entity);\r\n          }\r\n          if (subscription) {\r\n            subscription.unsubscribe();\r\n          }\r\n        }\r\n      };\r\n    }));\r\n  }\r\n}\r\n","import { combineLatest, of as rxof, Observable, UnaryFunction, OperatorFunction, ObservedValueOf } from 'rxjs';\r\n\r\nexport type ValuedSubject<T, V extends T = T> = ValuedObservable<T> & { next: (value: V) => void; };\r\n\r\n\r\nimport { distinctUntilChanged, map as rxmap, tap } from 'rxjs/operators';\r\nimport { alternMap } from 'altern-map';\r\n\r\nexport type ValuedObservable<T> = Observable<T> & { readonly value: T; };\r\nexport const of = <T>(value: T) => Object.assign(rxof(value), { value });\r\nexport const map = <T, R>(o: ValuedObservable<T>, p: (v: T) => R): ValuedObservable<R> => Object.defineProperty(\r\n\to.pipe(rxmap(p)), 'value', { get: () => p(o.value) }\r\n);\r\nexport const distinct = <T>(o: ValuedObservable<T>, eq?: (a: T, b: T) => boolean): ValuedObservable<T> => Object.defineProperty(\r\n\to.pipe(distinctUntilChanged(eq)), 'value', { get: () => o.value }\r\n);\r\nexport const altern = <T, R>(o: ValuedObservable<T>, p: (v: T) => ValuedObservable<R>): ValuedObservable<R> => Object.defineProperty(\r\n\to.pipe(alternMap(p)), 'value', { get: () => p(o.value).value }\r\n);\r\nexport const combine = <O extends ValuedObservable<any>>(sources: O[]): ValuedObservable<ObservedValueOf<O>[]> => Object.defineProperty(\r\n\tcombineLatest(sources), 'value', { get: () => sources.map(s => s.value) }\r\n);\r\nexport const pipe = <T>(o: ValuedObservable<T>, op: OperatorFunction<T, T>): ValuedObservable<T> => Object.defineProperty(\r\n\to.pipe(op), 'value', { get: () => o.value }\r\n);\r\nexport const fromPromise = <T>(p: Promise<T>, value: T) => {\r\n\tconst observable = new Observable<T>(subs => {\r\n\t\tlet done = false;\r\n\t\tsubs.next(value);\r\n\t\tp.then(v => {\r\n\t\t\tif (!done) subs.next(value = v);\r\n\t\t\tsubs.complete();\r\n\t\t}, err => subs.error(err));\r\n\t\treturn () => { done = true; };\r\n\t});\r\n\treturn observable as ValuedObservable<T>;\r\n};","module.exports = __WEBPACK_EXTERNAL_MODULE_rxjs__;","module.exports = __WEBPACK_EXTERNAL_MODULE_rxjs_operators__;"],"sourceRoot":""}