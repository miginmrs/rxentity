!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["rxjs","rxjs/operators"],e):"object"==typeof exports?exports.rxentity=e(require("rxjs"),require("rxjs/operators")):t.rxentity=e(t.rxjs,t.rxjs.operators)}(window,(function(t,e){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=20)}([function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=r(10),o=r(11),u=r(22),c=r(13),a=r(5),l=r(6),h=function(t){function e(r,n,i){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=o.empty;break;case 1:if(!r){s.destination=o.empty;break}if("object"==typeof r){r instanceof e?(s.syncErrorThrowable=r.syncErrorThrowable,s.destination=r,r.add(s)):(s.syncErrorThrowable=!0,s.destination=new p(s,r));break}default:s.syncErrorThrowable=!0,s.destination=new p(s,r,n,i)}return s}return i(e,t),e.prototype[c.rxSubscriber]=function(){return this},e.create=function(t,r,n){var i=new e(t,r,n);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(u.Subscription);e.Subscriber=h;var p=function(t){function e(e,r,n,i){var u,c=t.call(this)||this;c._parentSubscriber=e;var a=c;return s.isFunction(r)?u=r:r&&(u=r.next,n=r.error,i=r.complete,r!==o.empty&&(a=Object.create(r),s.isFunction(a.unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(c))),c._context=a,c._next=u,c._error=n,c._complete=i,c}return i(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;a.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=a.config.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):l.hostReportError(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;l.hostReportError(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};a.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),a.config.useDeprecatedSynchronousErrorHandling)throw t;l.hostReportError(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!a.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return a.config.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(l.hostReportError(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(h);e.SafeSubscriber=p},function(t,e,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(4),e),i(r(21),e),i(r(37),e),i(r(9),e)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinkedBehaviorSubject=e.EntityAbstract=void 0;const n=r(16),i=r(0);e.EntityAbstract=class{constructor(t){this.store=t,this.unlinkAll=()=>{Object.keys(this.rxMap).forEach(t=>this.rxMap[t].unlink())},this.update=t=>{const e=this.rx;Object.keys(t).forEach(r=>{e(r).next(t[r])})},this.rewind=t=>{},this.setParent=()=>{},this.levelOf=t=>n.of(0)}get snapshot(){const t={},e=this.rx;for(const r of Object.keys(this.rxMap))t[r]=e(r).value;return t}};class s extends i.BehaviorSubject{unlink(){var t;null===(t=this._subs)||void 0===t||t.unsubscribe()}next(t){this.unlink(),i.isObservable(t)&&(this._subs=t.subscribe(()=>{})),super.next(t)}}e.LinkedBehaviorSubject=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=!1;e.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else n&&console.log("RxJS: Back to a better error behavior. Thank you. <3");n=t},get useDeprecatedSynchronousErrorHandling(){return n}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hostReportError=function(t){setTimeout((function(){throw t}),0)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,r,n){var i=t.call(this)||this;return i.parent=e,i.outerValue=r,i.outerIndex=n,i.index=0,i}return i(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(r(2).Subscriber);e.InnerSubscriber=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$local=e.$snapshot=e.$update=e.$rewind=e.$levelOf=e.$rxMap=e.$rx=e.toEntity=e.entityFlow=e.getEntity=void 0;const n=r(17),i=new WeakMap;function s(t){if(t)return i.get(t)}e.getEntity=s;const o=(t,e)=>t.pipe(n.alternMap(t=>s(t).rx(e)));e.entityFlow=(t,e)=>new Proxy({},{get:(r,n)=>"observable"===n?t:"field"===n?e||(e=new Proxy({},{get:(e,r)=>o(t,r)})):o(t,n)}),e.toEntity=t=>{const e=new Proxy(Object.prototype,{get:(e,r)=>t.rx(r),ownKeys:()=>Object.keys(t.rxMap)});return i.set(e,t),e},e.$rx=(t,e)=>s(t).rx(e),e.$rxMap=t=>s(t).rxMap,e.$levelOf=(t,e)=>s(t).levelOf(e),e.$rewind=(t,e)=>s(t).rewind(e),e.$update=(t,e)=>s(t).update(e),e.$snapshot=t=>s(t).snapshot,e.$local=t=>s(t).local},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isFunction=function(t){return"function"==typeof t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(5),i=r(6);e.empty={closed:!0,next:function(t){},error:function(t){if(n.config.useDeprecatedSynchronousErrorHandling)throw t;i.hostReportError(t)},complete:function(){}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isObject=function(t){return null!==t&&"object"==typeof t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),e.$$rxSubscriber=e.rxSubscriber},function(t,e,r){"use strict";function n(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(e,"__esModule",{value:!0}),e.getSymbolIterator=n,e.iterator=n(),e.$$iterator=e.iterator},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Keys=e.guard=e.asAsync=e.wait=e.runit=void 0,e.runit=(t,e)=>{const r=(...n)=>{const i=1==n.length?t.next(n[0]):n.length?t.throw(n[1]):t.next();return i.done?e.resolve(i.value):e.resolve(i.value).then(r,t=>r(null,t))};return r()},e.wait=function*(t){return yield t},e.asAsync=function(t,r,n){return(...i)=>e.runit(t.call(n,...i),r)},e.guard=(t,e)=>e;e.Keys=class{constructor(t){this.keys=Object.keys(t)}mapTo(t){const e={};return this.keys.forEach((r,n)=>e[r]=t(r,n)),e}asyncMapTo(t,e){const r={};return e.all(this.keys.map(e=>t(e).then(t=>r[e]=t))).then(()=>r)}}},function(t,e,r){"use strict";r.r(e),r.d(e,"of",(function(){return s})),r.d(e,"map",(function(){return o})),r.d(e,"distinctUntilChanged",(function(){return u})),r.d(e,"combine",(function(){return c})),r.d(e,"idem",(function(){return a})),r.d(e,"startWith",(function(){return l})),r.d(e,"fromPromise",(function(){return h}));var n=r(0),i=r(1);const s=t=>Object.assign(Object(n.of)(t),{value:t});function o(t,e,r){const n=Object(i.map)(t,e);return r?r=>{const i=n(r);return Object.defineProperty(i,"value",{get:()=>t.call(e,r.value,-1)})}:n}function u(t,e,r){const n=t&&e?Object(i.distinctUntilChanged)(t,e):Object(i.distinctUntilChanged)(t);return r?t=>{const e=t.pipe(n);return Object.defineProperty(e,"value",{get:()=>t.value})}:n}const c=t=>Object.defineProperty(Object(n.combineLatest)(t),"value",{get:()=>t.map(t=>t.value)}),a=t=>e=>Object.defineProperty(e.pipe(t),"value",{get:()=>e.value}),l=(t,e)=>{const r=new n.BehaviorSubject(e);return Object.defineProperty(t.pipe(Object(i.multicast)(r),Object(i.refCount)()),"value",{get:()=>r.value})},h=(t,e)=>{const r=new n.Observable(r=>{let n=!1;return r.next(e),t.then(t=>{n||r.next(e=t),r.complete()},t=>r.error(t)),()=>{n=!0}});return Object.defineProperty(r,"value",()=>e)}},function(t,e,r){"use strict";r.r(e),r.d(e,"alternMap",(function(){return o}));var n=r(18),i=r(8),s=r(19);function o(...t){const[e,r]=t,n=t=>t.lift(new u(e,r||{}));if(!t[2])return n;const i=t[0];return t=>Object.defineProperty(n(t),"value",{get:()=>i(t.value,-1).value})}class u{constructor(t,e){this.project=t,this.options=e}call(t,e){return e.subscribe(new c(t,this.project,this.options))}}class c extends n.OuterSubscriber{constructor(t,e,r){super(t),this.project=e,this.options=r,this.index=0}_next(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,r)}_innerSub(t,e,r){const n=this.innerSubscription,o=new i.InnerSubscriber(this,e,r),u=this.destination;u.add(o),this.innerSubscription=Object(s.subscribeToResult)(this,t,void 0,void 0,o),this.innerSubscription!==o&&u.add(this.innerSubscription),n&&n.unsubscribe()}_complete(){const{innerSubscription:t}=this;(!t||t.closed||this.options.completeWithSource)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.destination.remove(t),this.innerSubscription=null,(this.isStopped||this.options.completeWithInner)&&super._complete()}notifyNext(t,e,r,n,i){this.destination.next(e)}}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(r(2).Subscriber);e.OuterSubscriber=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=r(25),s=r(32);e.subscribeToResult=function(t,e,r,o,u){if(void 0===u&&(u=new n.InnerSubscriber(t,r,o)),!u.closed)return e instanceof s.Observable?e.subscribe(u):i.subscribeTo(e)(u)}},function(t,e,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(3),e),i(r(38),e),i(r(15),e),i(r(41),e)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChildEntityImpl=void 0;const n=r(0),i=r(4),s=r(16),o=r(9),u=r(17);class c extends i.EntityAbstract{constructor(t){super(t.store),this.rx=t=>this.rxMap[t]||(this.rxMap[t]=this.createRx(t)),this.rxSource=t=>this.rxSourceMap[t]||(this.rxSourceMap[t]=new n.BehaviorSubject(this._parent?o.$rx(this._parent,t):new n.BehaviorSubject(void 0))),this._parent=void 0,this.setParent=t=>{const e=this.parent;this._parent=t;const r=this.rxSourceMap;t&&Object.keys(r).forEach(e=>{void 0===r[e].value&&r[e].next(o.$rx(t,e))}),e&&Object.keys(o.$rxMap(e)).forEach(i=>{var s;(null===(s=r[i])||void 0===s?void 0:s.value)===o.$rxMap(e)[i]&&(t?r[i].next(o.$rx(t,i)):r[i].next(new n.BehaviorSubject(o.$rxMap(e)[i].value)))})},this.rewind=t=>{const e=this._parent;e&&(t?[t]:Object.keys(this.rxSourceMap)).forEach(t=>{this.rx(t).unlink(),this.rxSource(t).next(o.$rx(e,t))})},this.levelOf=t=>this.rxSource(t).pipe(u.alternMap(e=>{var r;return e===(null===(r=this._parent)||void 0===r?void 0:r[t])?o.$levelOf(this._parent,t).pipe(s.map(t=>t+1,0,!0)):s.of(0)},{},!0));const e=this.rxMap={},r=this.rxSourceMap={};let i;if(t.ready){const{data:e,parent:s}=t;this._parent=s,i=Object.keys(o.$rxMap(s)),i.forEach(t=>{const i=t in e?new n.BehaviorSubject(e[t]):o.$rx(s,t);r[t]=new n.BehaviorSubject(i)})}else{const{data:e,parentPromise:s}=t;i=Object.keys(e),s.then(this.setParent),i.forEach(t=>{r[t]=new n.BehaviorSubject(new n.BehaviorSubject(e[t]))})}i.forEach(t=>e[t]=this.createRx(t))}createRx(t){const e=this.rxSource(t),r=u.alternMap(n.identity,{},!0);let i;return Object.assign(e.pipe(r),{next:r=>{let s=i;n.isObservable(r)&&(i=r.subscribe(()=>{})),null==s||s.unsubscribe(),this._parent&&e.value===o.$rx(this._parent,t)?e.next(new n.BehaviorSubject(r)):e.value.next(r)},unlink:()=>null==i?void 0:i.unsubscribe()})}get parent(){return this._parent}get local(){if(!this._parent)return this.snapshot;const t=this._parent,e={},r=this.rxSourceMap;for(const n of Object.keys(r)){const i=r[n].value;i!==o.$rxMap(t)[n]&&(e[n]=i.value)}return e}}e.ChildEntityImpl=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(23),i=r(12),s=r(10),o=r(24),u=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this._parentOrParents,u=this._ctorUnsubscribe,a=this._unsubscribe,l=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var h=0;h<r.length;++h){r[h].remove(this)}if(s.isFunction(a)){u&&(this._unsubscribe=void 0);try{a.call(this)}catch(t){e=t instanceof o.UnsubscriptionError?c(t.errors):[t]}}if(n.isArray(l)){h=-1;for(var p=l.length;++h<p;){var b=l[h];if(i.isObject(b))try{b.unsubscribe()}catch(t){e=e||[],t instanceof o.UnsubscriptionError?e=e.concat(c(t.errors)):e.push(t)}}}if(e)throw new o.UnsubscriptionError(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=r._parentOrParents;if(null===i)r._parentOrParents=this;else if(i instanceof t){if(i===this)return r;r._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return r;i.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[r]:s.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function c(t){return t.reduce((function(t,e){return t.concat(e instanceof o.UnsubscriptionError?e.errors:e)}),[])}e.Subscription=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}();e.UnsubscriptionError=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(26),i=r(27),s=r(28),o=r(29),u=r(30),c=r(31),a=r(12),l=r(14),h=r(7);e.subscribeTo=function(t){if(t&&"function"==typeof t[h.observable])return o.subscribeToObservable(t);if(u.isArrayLike(t))return n.subscribeToArray(t);if(c.isPromise(t))return i.subscribeToPromise(t);if(t&&"function"==typeof t[l.iterator])return s.subscribeToIterable(t);var e=a.isObject(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.subscribeToArray=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.complete()}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(6);e.subscribeToPromise=function(t){return function(e){return t.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,n.hostReportError),e}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(14);e.subscribeToIterable=function(t){return function(e){for(var r=t[n.iterator]();;){var i=void 0;try{i=r.next()}catch(t){return e.error(t),e}if(i.done){e.complete();break}if(e.next(i.value),e.closed)break}return"function"==typeof r.return&&e.add((function(){r.return&&r.return()})),e}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(7);e.subscribeToObservable=function(t){return function(e){var r=t[n.observable]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isArrayLike=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isPromise=function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(33),i=r(34),s=r(7),o=r(35),u=r(5),c=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,s=i.toSubscriber(t,e,r);if(n?s.add(n.call(s,this.source)):s.add(this.source||u.config.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),u.config.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){u.config.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),n.canReportError(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=a(e))((function(e,n){var i;i=r.subscribe((function(e){try{t(e)}catch(t){n(t),i&&i.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[s.observable]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:o.pipeFromArray(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=a(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function a(t){if(t||(t=u.config.Promise||Promise),!t)throw new Error("no Promise impl found");return t}e.Observable=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2);e.canReportError=function(t){for(;t;){var e=t,r=e.closed,i=e.destination,s=e.isStopped;if(r||s)return!1;t=i&&i instanceof n.Subscriber?i:null}return!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),i=r(13),s=r(11);e.toSubscriber=function(t,e,r){if(t){if(t instanceof n.Subscriber)return t;if(t[i.rxSubscriber])return t[i.rxSubscriber]()}return t||e||r?new n.Subscriber(t,e,r):new n.Subscriber(s.empty)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(36);function i(t){return 0===t.length?n.identity:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}e.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i(t)},e.pipeFromArray=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.identity=function(t){return t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EntityImpl=void 0;const n=r(4);class i extends n.EntityAbstract{constructor(t,e){super(e),this.rx=t=>this.rxMap[t]||(this.rxMap[t]=new n.LinkedBehaviorSubject(void 0));const r=this.rxMap={};Object.keys(t).forEach(e=>{r[e]=new n.LinkedBehaviorSubject(t[e])})}get local(){return this.snapshot}}e.EntityImpl=i},function(t,e,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(39),e),i(r(40),e)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChildStoredList=e.TopStoredList=e.AbstractStoredList=void 0;const n=r(0),i=r(1),s=r(3),o=r(15);class u{constructor(t){this.list=null,this.subscriber=null,this.donePromises=[],this.entities=new n.Observable(t=>(this.list={data:[],status:void 0},this.subscriber=t,this.reload(),()=>{var t,e;null===(t=this.parentSubsctiption)||void 0===t||t.unsubscribe(),this.parentSubsctiption=void 0,this.subscriber=null,null===(e=this.list)||void 0===e||e.data.forEach(t=>t.subscription.unsubscribe()),this.list=null})).pipe(i.shareReplay({bufferSize:1,refCount:!0})),this._exec=(t,e,r,n)=>o.asAsync((function*(){var i,s;let u=[];try{if(console.log(1,{n:t,err:e,from:r,to:n,this:this}),!this._setDone(t,u,this.list))return yield*o.wait(u[0]);console.log(2,{n:t,err:e,from:r,to:n,this:this});const c=t?this.list.data:[];[r,n]=[r||(null===(i=c[0])||void 0===i?void 0:i.entity),n||(null===(s=c[c.length-1])||void 0===s?void 0:s.entity)];const a=yield*o.wait(this.retrieve(r,n,e));if(console.log(3,{n:t,err:e,from:r,to:n,this:this,retrieved:a}),!this._setDone(t,u,this.list))return yield*o.wait(u[0]);console.log(4,{n:t,err:e,from:r,to:n,this:this});const l=yield*o.wait(this._populate(a.data));if(console.log(5,{n:t,err:e,from:r,to:n,this:this}),!this._setDone(t,u,this.list))return yield*o.wait(u[0]);console.log(6,{n:t,err:e,from:r,to:n,this:this}),t||this.list.data.forEach(t=>t.subscription.unsubscribe()),this.list={data:c.concat(l),status:a.done};const h=()=>{if(!this.list)throw new Error("Unexpected state");return this.subscriber.next({list:this.list.data.map(t=>t.entity),status:this.list.status}),a.done};return console.log(7,{n:t,err:e,from:r,to:n,this:this}),void 0===a.done?yield*this.fromParent(t,h):h()}catch(i){return this._setDone(t,u,this.list)?(console.log(8,{n:t,err:e,from:r,to:n,this:this}),this.list.status=null,yield*this.handleError(t,i)):yield*o.wait(u[0])}finally{console.log(9,{n:t,err:e,from:r,to:n,this:this}),this.donePromises[t]=void 0}}),this.promiseCtr,this)();const{key:e,merge:r,retrieve:s,keyof:u,keyofEntity:c,stores:a,promiseCtr:l}=t;this.keyof=u,this.keyofEntity=c,this.stores=a,this.keys=new o.Keys(a),this.retrieve=s,this.key=e,this.merge=r,this.promiseCtr=l}add(t){var e;const r=this.key,i=this.keyofEntity(r,t[r]);if(null===this.list||this.list.data.find(t=>this.keyofEntity(r,t.entity[r])===i))return;const s=new n.Subscription,u=this.stores;new o.Keys(t).keys.forEach(t=>{const e=u[t].get(i).observable;s.add(e.subscribe())}),this.list={data:[{entity:t,subscription:s},...this.list.data],status:this.list.status},null===(e=this.subscriber)||void 0===e||e.next({list:this.list.data.map(t=>t.entity),status:this.list.status})}remove(t){var e;if(null===this.list)return;const r=this.list.data.findIndex(e=>e.entity[this.key]===t);if(-1!==r){const n=this.list;this.removeFromParent(t),n.data[r].subscription.unsubscribe(),n.data.splice(r,1),null===(e=this.subscriber)||void 0===e||e.next({list:n.data.map(t=>t.entity),status:n.status})}}toPromise(t){const e=t.map(o.asAsync((function*(t){const e=new n.Subscription,r=this.keys.asyncMapTo(r=>new this.promiseCtr(n=>e.add(t[r].observable.subscribe(n))),this.promiseCtr);return yield*o.wait(r.then(t=>({subscription:e,entity:t})))}),this.promiseCtr,this));return this.promiseCtr.all(e)}_status(t,e){return null===t?null:null!=t?t:e}_populate(t){const e=t.map(t=>this.keys.mapTo(e=>this.stores[e].get(this.keyof(e,t[e])))),r=this.toPromise(e);return this.keys.keys.forEach(e=>this.stores[e].nextBulk(t.map(t=>({id:this.keyof(e,t[e]),data:t[e]})))),r}reload(t){return this.exec(0,t)}more(t){return this.exec(1,t)}_setDone(t,e,r){if(null===r)return e[0]=this.promiseCtr.resolve(!0),!1;if(t>0){const r=this.donePromises[t-1];if(r)return e[0]=r,!1}return!0}exec(t,e,r,n){return this.donePromises[t]||(this.donePromises[t]=this._exec(t,e,r,n))}}e.AbstractStoredList=u;e.TopStoredList=class extends u{*handleError(t,e){throw e}*fromParent(t,e){return e()}removeFromParent(){}};e.ChildStoredList=class extends u{constructor(t){super(t),this.parentSubscriber=()=>new this.promiseCtr((t,e)=>{var r;this.parentSubsctiption=null===(r=this.parent)||void 0===r?void 0:r.entities.subscribe(r=>o.asAsync((function*(){var n,i;const s=this.key,u=r.list.map(t=>this.keys.mapTo(e=>this.stores[e].get(this.keyofEntity(e,t[e])))),c=new Set(null===(n=this.list)||void 0===n?void 0:n.data.map(t=>t.entity[s])),a=yield*o.wait(this.toPromise(u)),l=a.filter(t=>!c.has(t.entity[s])).map(t=>this.keys.mapTo(e=>this.keyofEntity(e,t.entity[e]))),h=yield*o.wait(this.toPromise(l.map(t=>this.keys.mapTo(e=>this.stores[e].get(t[e])))));if(a.forEach(t=>t.subscription.unsubscribe()),!this.list)return e();const p=this.merge(s,this.list.data,h);return this.list={data:p,status:this._status(this.list.status,r.status)},null===(i=this.subscriber)||void 0===i||i.next({list:this.list.data.map(({entity:t})=>t),status:this.list.status}),t(this.list.status)}),this.promiseCtr,this)())}),this.parent=t.parent}*fromParent(t){try{return yield*o.wait(this.parentSubsctiption?this.parent.exec(t,null):this.parentSubscriber())}catch(t){return!0}}*handleError(t,e){try{const r=yield*o.wait(this.parentSubsctiption?this.parent.exec(t,e):this.parentSubscriber());return this._status(null,r)}catch(e){return!0}}removeFromParent(t){const e=s.getEntity(t);if(e instanceof s.ChildEntityImpl){const t=e;t.parent&&this.parent.remove(t.parent)}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TopStore=e.ChildStore=e.AbstractStore=void 0;const n=r(0),i=r(3);class s{constructor(t,e,r){this.name=t,this.finalize=e,this.promiseCtr=r,this._items=new Map,this.insersions=new n.Subject,this.emptyInsersions=new n.Subject}rewind(t){var e;const r=this._items.get(t);null===(e=i.getEntity(null==r?void 0:r.entity))||void 0===e||e.rewind()}prepare(t,e){const r=this.get(t);return new n.Observable(n=>{const i=r.observable.subscribe(n),s=this._items.get(t);if(!s)return;return(s.next=(s.next||{then:(t,e)=>{try{return this.promiseCtr.resolve(e())}catch(t){return this.promiseCtr.reject(t)}}}).then(void 0,()=>{const t=s;if(!s.closed&&!s.ready)return e(s.id,{get ready(){return t.ready}},t=>i.add(t))})).then(void 0,()=>{}),i})}nextBulk(t){const e=t.filter(({id:t,data:e})=>this._next(t,e)).map(({id:t})=>t);this.insersions.next(e)}next(t,e){this._next(t,e)&&this.insersions.next([t])}_next(t,e){const r=this._items.get(t);if(r){if(r.entity)return i.$update(r.entity,e),r.ready=!0,!1;{this.setItemEntity(t,e,r);const n=r.entity;return r.ready=!0,r.observers.forEach(t=>t.next(n)),!0}}}updateId(t,e){var r,n;if(this._items.get(e))throw new Error('New Id "'+e+'" is taken');const s=this._items.get(t);s&&(s.id=e,this._items.delete(t),this._items.set(e,s),null===(r=i.getEntity(s.entity))||void 0===r||r.setParent(),null===(n=s.parentSubscription)||void 0===n||n.unsubscribe(),this.linkParentNewId(t,e,s))}update(t,e){var r,n;null===(n=i.getEntity(null===(r=this._items.get(t))||void 0===r?void 0:r.entity))||void 0===n||n.update(e)}item(t,e){let r=this._items.get(t);return r?r.observers.push(e):this._items.set(t,r={id:t,observers:[e]}),r}get(t,e){return i.entityFlow(new n.Observable(r=>{const n=this.item(t,r),s=n.observers;return n.entity?e||r.next(n.entity):this.subscribeToParent(t,n,e),()=>{const t=n.id,e=s.indexOf(r);if(-1!==e&&s.splice(e,1),!s.length){const e=n.parentSubscription;this._items.delete(t),n.closed=!0,n.entity&&this.finalize(t,n.entity),e&&e.unsubscribe(),n.entity&&i.getEntity(n.entity).unlinkAll()}}}))}}e.AbstractStore=s;e.ChildStore=class extends s{constructor(t,e,r,n){super(t,e,r),this.parent=n}setItemEntity(t,e,r){const n=this.parent.get(t);r.entity=i.toEntity(new i.ChildEntityImpl({store:this,data:e,ready:!1,parentPromise:{then:t=>{var e;const i=n.observable.subscribe(e=>t(e));null===(e=r.parentSubscription)||void 0===e||e.unsubscribe(),r.parentSubscription=i}}}))}linkParentNewId(t,e,r){const n=this.parent.get(e),s=r.entity;s&&(r.parentSubscription=n.observable.subscribe(t=>{i.getEntity(s).setParent(t)}))}subscribeToParent(t,e,r){if(!e.parentSubscription){const n=e.observers;let s=!r;e.parentSubscription=this.parent.get(t).observable.subscribe(t=>{e.entity=i.toEntity(new i.ChildEntityImpl({data:{},parent:t,ready:!0,store:this})),this.emptyInsersions.next(e.id),s&&n.forEach(t=>t.next(e.entity))}),s=!0}}};e.TopStore=class extends s{constructor(t,e,r){super(t,e,r)}setItemEntity(t,e,r){r.entity=i.toEntity(new i.EntityImpl(e,this))}linkParentNewId(){}subscribeToParent(){}}}])}));