!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["rxjs","rxjs/operators"],e):"object"==typeof exports?exports.rxentity=e(require("rxjs"),require("rxjs/operators")):t.rxentity=e(t.rxjs,t.rxjs.operators)}(window,(function(t,e){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=19)}([function(e,r){e.exports=t},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=r(11),o=r(12),u=r(20),c=r(14),a=r(6),l=r(7),h=function(t){function e(r,i,n){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=o.empty;break;case 1:if(!r){s.destination=o.empty;break}if("object"==typeof r){r instanceof e?(s.syncErrorThrowable=r.syncErrorThrowable,s.destination=r,r.add(s)):(s.syncErrorThrowable=!0,s.destination=new p(s,r));break}default:s.syncErrorThrowable=!0,s.destination=new p(s,r,i,n)}return s}return n(e,t),e.prototype[c.rxSubscriber]=function(){return this},e.create=function(t,r,i){var n=new e(t,r,i);return n.syncErrorThrowable=!1,n},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(u.Subscription);e.Subscriber=h;var p=function(t){function e(e,r,i,n){var u,c=t.call(this)||this;c._parentSubscriber=e;var a=c;return s.isFunction(r)?u=r:r&&(u=r.next,i=r.error,n=r.complete,r!==o.empty&&(a=Object.create(r),s.isFunction(a.unsubscribe)&&c.add(a.unsubscribe.bind(a)),a.unsubscribe=c.unsubscribe.bind(c))),c._context=a,c._next=u,c._error=i,c._complete=n,c}return n(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;a.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=a.config.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):l.hostReportError(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;l.hostReportError(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};a.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),a.config.useDeprecatedSynchronousErrorHandling)throw t;l.hostReportError(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!a.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return a.config.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(l.hostReportError(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(h);e.SafeSubscriber=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Keys=e.toKeyOf=e.guard=e.asAsync=e.wait=e.runit=void 0,e.runit=(t,e)=>{const r=(...i)=>{const n=i.length?t.next(i[0]):t.next();return n.done?e.resolve(n.value):e.resolve(n.value).then(r)};return r()},e.wait=function*(t){return yield t},e.asAsync=function(t,r,i){return(...n)=>e.runit(t.call(i,...n),r)},e.guard=(t,e)=>e,e.toKeyOf=t=>t;e.Keys=class{constructor(t){this.keys=Object.keys(t)}mapTo(t){const e={};return this.keys.forEach((r,i)=>e[r]=t(r,i)),e}asyncMapTo(t,e){const r={};return e.all(this.keys.map(e=>t(e).then(t=>r[e]=t))).then(()=>r)}}},function(t,r){t.exports=e},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EntityAbstract=void 0;const i=r(5);e.EntityAbstract=class{constructor(){this.update=t=>{const e=this.rx;Object.keys(t).forEach(r=>{e(r).next(t[r])})},this.rewind=t=>{},this.setParent=()=>{},this.levelOf=t=>i.of(0)}get snapshot(){const t={},e=this.rx;for(const r of Object.keys(this.rxMap))t[r]=e(r).value;return t}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.fromPromise=e.pipe=e.combine=e.altern=e.distinct=e.map=e.of=void 0;const i=r(0),n=r(3),s=r(16);e.of=t=>Object.assign(i.of(t),{value:t}),e.map=(t,e)=>Object.defineProperty(t.pipe(n.map(e)),"value",{get:()=>e(t.value)}),e.distinct=(t,e)=>Object.defineProperty(t.pipe(n.distinctUntilChanged(e)),"value",{get:()=>t.value}),e.altern=(t,e)=>Object.defineProperty(t.pipe(s.alternMap(e)),"value",{get:()=>e(t.value).value}),e.combine=t=>Object.defineProperty(i.combineLatest(t),"value",{get:()=>t.map(t=>t.value)}),e.pipe=(t,e)=>Object.defineProperty(t.pipe(e),"value",{get:()=>t.value}),e.fromPromise=(t,e)=>new i.Observable(r=>{let i=!1;return r.next(e),t.then(t=>{i||r.next(e=t),r.complete()},t=>r.error(t)),()=>{i=!0}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=!1;e.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=t},get useDeprecatedSynchronousErrorHandling(){return i}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hostReportError=function(t){setTimeout((function(){throw t}),0)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,r,i){var n=t.call(this)||this;return n.parent=e,n.outerValue=r,n.outerIndex=i,n.index=0,n}return n(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(r(1).Subscriber);e.InnerSubscriber=s},function(t,e,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||i(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(r(4),e),n(r(35),e),n(r(36),e),n(r(37),e)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isFunction=function(t){return"function"==typeof t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6),n=r(7);e.empty={closed:!0,next:function(t){},error:function(t){if(i.config.useDeprecatedSynchronousErrorHandling)throw t;n.hostReportError(t)},complete:function(){}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isObject=function(t){return null!==t&&"object"==typeof t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),e.$$rxSubscriber=e.rxSubscriber},function(t,e,r){"use strict";function i(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(e,"__esModule",{value:!0}),e.getSymbolIterator=i,e.iterator=i(),e.$$iterator=e.iterator},function(t,e,r){"use strict";r.r(e),r.d(e,"alternMap",(function(){return c}));var i=r(0),n=r(3),s=r(17),o=r(9),u=r(18);function c(t,e,r){return"function"==typeof r?s=>s.pipe(c((e,s)=>Object(i.from)(t(e,s)).pipe(Object(n.map)((t,i)=>r(e,t,s,i))),e)):r=>r.lift(new a(t,e||{}))}class a{constructor(t,e){this.project=t,this.options=e}call(t,e){return e.subscribe(new l(t,this.project,this.options))}}class l extends s.OuterSubscriber{constructor(t,e,r){super(t),this.project=e,this.options=r,this.index=0}_next(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,r)}_innerSub(t,e,r){const i=this.innerSubscription,n=new o.InnerSubscriber(this,e,r),s=this.destination;s.add(n),this.innerSubscription=Object(u.subscribeToResult)(this,t,void 0,void 0,n),this.innerSubscription!==n&&s.add(this.innerSubscription),i&&i.unsubscribe()}_complete(){const{innerSubscription:t}=this;(!t||t.closed||this.options.completeWithSource)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.destination.remove(t),this.innerSubscription=null,(this.isStopped||this.options.completeWithInner)&&super._complete()}notifyNext(t,e,r,i,n){this.destination.next(e)}}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.notifyNext=function(t,e,r,i,n){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(r(1).Subscriber);e.OuterSubscriber=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(9),n=r(23),s=r(30);e.subscribeToResult=function(t,e,r,o,u){if(void 0===u&&(u=new i.InnerSubscriber(t,r,o)),!u.closed)return e instanceof s.Observable?e.subscribe(u):n.subscribeTo(e)(u)}},function(t,e,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||i(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(r(10),e),n(r(38),e),n(r(2),e),n(r(41),e),n(r(5),e)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(21),n=r(13),s=r(11),o=r(22),u=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this._parentOrParents,u=this._ctorUnsubscribe,a=this._unsubscribe,l=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var h=0;h<r.length;++h){r[h].remove(this)}if(s.isFunction(a)){u&&(this._unsubscribe=void 0);try{a.call(this)}catch(t){e=t instanceof o.UnsubscriptionError?c(t.errors):[t]}}if(i.isArray(l)){h=-1;for(var p=l.length;++h<p;){var b=l[h];if(n.isObject(b))try{b.unsubscribe()}catch(t){e=e||[],t instanceof o.UnsubscriptionError?e=e.concat(c(t.errors)):e.push(t)}}}if(e)throw new o.UnsubscriptionError(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var i=r;(r=new t)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var n=r._parentOrParents;if(null===n)r._parentOrParents=this;else if(n instanceof t){if(n===this)return r;r._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return r;n.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[r]:s.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function c(t){return t.reduce((function(t,e){return t.concat(e instanceof o.UnsubscriptionError?e.errors:e)}),[])}e.Subscription=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}();e.UnsubscriptionError=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(24),n=r(25),s=r(26),o=r(27),u=r(28),c=r(29),a=r(13),l=r(15),h=r(8);e.subscribeTo=function(t){if(t&&"function"==typeof t[h.observable])return o.subscribeToObservable(t);if(u.isArrayLike(t))return i.subscribeToArray(t);if(c.isPromise(t))return n.subscribeToPromise(t);if(t&&"function"==typeof t[l.iterator])return s.subscribeToIterable(t);var e=a.isObject(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.subscribeToArray=function(t){return function(e){for(var r=0,i=t.length;r<i&&!e.closed;r++)e.next(t[r]);e.complete()}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(7);e.subscribeToPromise=function(t){return function(e){return t.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,i.hostReportError),e}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(15);e.subscribeToIterable=function(t){return function(e){for(var r=t[i.iterator]();;){var n=void 0;try{n=r.next()}catch(t){return e.error(t),e}if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof r.return&&e.add((function(){r.return&&r.return()})),e}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(8);e.subscribeToObservable=function(t){return function(e){var r=t[i.observable]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isArrayLike=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isPromise=function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(31),n=r(32),s=r(8),o=r(33),u=r(6),c=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var i=this.operator,s=n.toSubscriber(t,e,r);if(i?s.add(i.call(s,this.source)):s.add(this.source||u.config.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),u.config.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){u.config.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),i.canReportError(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=a(e))((function(e,i){var n;n=r.subscribe((function(e){try{t(e)}catch(t){i(t),n&&n.unsubscribe()}}),i,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[s.observable]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:o.pipeFromArray(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=a(t))((function(t,r){var i;e.subscribe((function(t){return i=t}),(function(t){return r(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}();function a(t){if(t||(t=u.config.Promise||Promise),!t)throw new Error("no Promise impl found");return t}e.Observable=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1);e.canReportError=function(t){for(;t;){var e=t,r=e.closed,n=e.destination,s=e.isStopped;if(r||s)return!1;t=n&&n instanceof i.Subscriber?n:null}return!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(14),s=r(12);e.toSubscriber=function(t,e,r){if(t){if(t instanceof i.Subscriber)return t;if(t[n.rxSubscriber])return t[n.rxSubscriber]()}return t||e||r?new i.Subscriber(t,e,r):new i.Subscriber(s.empty)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(34);function n(t){return 0===t.length?i.identity:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}e.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n(t)},e.pipeFromArray=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.identity=function(t){return t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChildEntityImpl=void 0;const i=r(0),n=r(4),s=r(5),o=r(2);class u extends n.EntityAbstract{constructor(t){super(),this.rx=t=>this.rxMap[t]||(this.rxMap[t]=this.createRx(t)),this.rxSource=t=>this.rxSourceMap[t]||(this.rxSourceMap[t]=new i.BehaviorSubject(this._parent?this._parent.rx(t):new i.BehaviorSubject(void 0))),this._parent=void 0,this.setParent=t=>{const e=this.parent;this._parent=t;const r=this.rxSourceMap;t&&Object.keys(r).forEach(e=>{void 0===r[e].value&&r[e].next(t.rx(e))}),e&&Object.keys(e.rxMap).forEach(n=>{var s;(null===(s=r[n])||void 0===s?void 0:s.value)===e.rxMap[n]&&(t?r[n].next(t.rx(n)):r[n].next(new i.BehaviorSubject(e.rxMap[n].value)))})},this.rewind=t=>{const e=this._parent;e&&(t?[o.toKeyOf(t)]:Object.keys(this.rxSourceMap)).forEach(t=>this.rxSource(t).next(e.rx(t)))},this.levelOf=t=>s.altern(this.rxSource(t),e=>{var r;return e===(null===(r=this._parent)||void 0===r?void 0:r.rxMap[t])?s.map(this._parent.levelOf(t),t=>t+1):s.of(0)});const e=this.rxMap={},r=this.rxSourceMap={};let n;if(void 0===t.parent){const{data:e,parentPromise:s}=t;n=Object.keys(e),s.then(this.setParent),n.forEach(t=>{r[t]=new i.BehaviorSubject(new i.BehaviorSubject(e[t]))})}else{const{data:e,parent:s}=t;this._parent=s,n=Object.keys(s.rxMap),n.forEach(t=>{const n=o.guard(t,t in e)?new i.BehaviorSubject(e[t]):s.rx(t);r[t]=new i.BehaviorSubject(n)})}n.forEach(t=>e[t]=this.createRx(t))}createRx(t){const e=this.rxSource(t);return Object.assign(s.altern(e,i.identity),{next:r=>this._parent&&e.value===this._parent.rx(t)?e.next(new i.BehaviorSubject(r)):e.value.next(r)})}get parent(){return this._parent}get local(){if(!this._parent)return this.snapshot;const t=this._parent,e={},r=this.rxSourceMap;for(const i of Object.keys(r)){const n=r[i].value;n!==t.rxMap[i]&&(e[i]=n.value)}return e}}e.ChildEntityImpl=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EntityImpl=void 0;const i=r(0),n=r(4);class s extends n.EntityAbstract{constructor(t){super(),this.rx=t=>this.rxMap[t]||(this.rxMap[t]=new i.BehaviorSubject(void 0));const e=this.rxMap={};Object.keys(t).forEach(r=>{e[r]=new i.BehaviorSubject(t[r])})}get local(){return this.snapshot}}e.EntityImpl=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toEntity=e.entityFlow=void 0;const i=r(16),n=r(2),s=(t,e)=>t.pipe(i.alternMap(t=>t.rx(e)));e.entityFlow=(t,e)=>new Proxy({},{get:(r,i)=>"observable"===i?t:"field"===i?e||(e=new Proxy({},{get:(e,r)=>s(t,r)})):s(t,i)}),e.toEntity=t=>new Proxy(t,{get(e,r){const i=r;return n.guard(r,i in t)?e[r]:e.rx(r)}})},function(t,e,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||i(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(r(39),e),n(r(40),e)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StoredList=void 0;const i=r(0),n=r(3),s=r(2);e.StoredList=class{constructor(t){this.list=null,this.subscriber=null,this.donePromises=[],this.parentSubscriber=()=>new this.promiseCtr((t,e)=>{var r;this.parentSubsctiption=null===(r=this.parent)||void 0===r?void 0:r.entities.subscribe(async r=>{var i,n;const s=this.key,o=r.list.map(t=>this.keys.mapTo(e=>this.stores[e].get(this.keyofEntity(e,t[e])))),u=new Set(null===(i=this.list)||void 0===i?void 0:i.data.map(t=>t.entity[s])),c=await this.toPromise(o),a=c.filter(t=>!u.has(t.entity[s])).map(t=>this.keys.mapTo(e=>this.keyofEntity(e,t.entity[e]))),l=await this.toPromise(a.map(t=>this.keys.mapTo(e=>this.stores[e].get(t[e]))));if(c.forEach(t=>t.subscription.unsubscribe()),!this.list)return e();const h=this.merge(s,this.list.data,l);return this.list={data:h,status:this._status(this.list.status,r.status)},null===(n=this.subscriber)||void 0===n||n.next({list:this.list.data.map(({entity:t})=>t),status:this.list.status}),t(this.list.status)})}),this.entities=new i.Observable(t=>(console.log("+++ subscribing",this.stores),this.list={data:[],status:void 0},this.subscriber=t,this.reload(),()=>{var t,e;null===(t=this.parentSubsctiption)||void 0===t||t.unsubscribe(),this.parentSubsctiption=void 0,this.subscriber=null,null===(e=this.list)||void 0===e||e.data.forEach(t=>t.subscription.unsubscribe()),this.list=null,console.log("xxx unsubscribed",this.stores)})).pipe(n.shareReplay({bufferSize:1,refCount:!0})),this._exec=(t,e,r,i)=>s.asAsync((function*(){var n,o;let u=[];try{if(console.log("1",t,this.stores[this.key]),!this._setDone(t,u,this.list))return yield*s.wait(u[0]);console.log("2",t,this.stores[this.key]);const c=t?this.list.data:[];[r,i]=[r||(null===(n=c[0])||void 0===n?void 0:n.entity),i||(null===(o=c[c.length-1])||void 0===o?void 0:o.entity)];const a=yield*s.wait(this.retrieve(r,i,e));if(console.log("3",t,this.stores[this.key]),!this._setDone(t,u,this.list))return yield*s.wait(u[0]);console.log("4",t,this.stores[this.key]);const l=yield*s.wait(this._populate(a.data));if(console.log("5",t,this.stores[this.key]),!this._setDone(t,u,this.list))return yield*s.wait(u[0]);if(console.log("6",t,this.stores[this.key]),t||this.list.data.forEach(t=>t.subscription.unsubscribe()),this.list={data:c.concat(l),status:a.done},void 0!==a.done||!this.parent)return this.subscriber.next({list:this.list.data.map(t=>t.entity),status:this.list.status}),console.log("7",t,this.stores[this.key]),a.done;try{const e=yield*s.wait(this.parentSubsctiption?this.parent.exec(t,null):this.parentSubscriber());return console.log("7u",t,this.stores[this.key],e),e}catch(t){return!0}}catch(e){if(console.log("8",t,this.stores[this.key]),!this._setDone(t,u,this.list))return yield*s.wait(u[0]);if(console.log("9",t,this.stores[this.key]),this.list.status=null,!this.parent)throw e;console.log("10",t,this.stores[this.key]);try{const r=yield*s.wait(this.parentSubsctiption?this.parent.exec(t,e):this.parentSubscriber());return console.log("11",t,this.stores[this.key],r),this._status(null,r)}catch(t){return!0}}finally{console.log("12",t,this.stores[this.key]),this.donePromises[t]=void 0}}),this.promiseCtr,this)();const{key:e,merge:r,retrieve:o,parent:u,keyof:c,keyofEntity:a,stores:l,promiseCtr:h}=t;this.keyof=c,this.keyofEntity=a,this.stores=l,this.keys=new s.Keys(l),this.retrieve=o,this.key=e,this.merge=r,this.parent=u,this.promiseCtr=h}add(t){var e;const r=this.key,n=this.keyofEntity(r,t[r]);if(null===this.list||this.list.data.find(t=>this.keyofEntity(r,t.entity[r])===n))return;const o=new i.Subscription,u=this.stores;new s.Keys(t).keys.forEach(t=>{o.add(u[t].get(n).observable.subscribe())}),this.list={data:[{entity:t,subscription:o},...this.list.data],status:this.list.status},null===(e=this.subscriber)||void 0===e||e.next({list:this.list.data.map(t=>t.entity),status:this.list.status})}remove(t){var e;if(null===this.list)return;const r=this.list.data.findIndex(e=>e.entity===t);if(-1!==r){const t=this.list;t.data[r].subscription.unsubscribe(),t.data.splice(r,1),null===(e=this.subscriber)||void 0===e||e.next({list:t.data.map(t=>t.entity),status:t.status})}}toPromise(t){return this.promiseCtr.all(t.map(async t=>({subscription:new i.Subscription,entity:await this.keys.asyncMapTo(e=>new this.promiseCtr(r=>t[e].observable.subscribe(r)),this.promiseCtr)})))}_status(t,e){return null===t?null:null!=t?t:e}_populate(t){const e=t.map(t=>this.keys.mapTo(e=>this.stores[e].get(this.keyof(e,t[e])))),r=this.toPromise(e);return this.keys.keys.forEach(e=>this.stores[e].nextBulk(t.map(t=>({id:this.keyof(e,t[e]),data:t[e]})))),r}reload(t){return this.exec(0,t)}more(t){return this.exec(1,t)}_setDone(t,e,r){if(null===r)return e[0]=this.promiseCtr.resolve(!0),!1;if(t>0){const r=this.donePromises[t-1];if(r)return e[0]=r,!1}return!0}exec(t,e,r,i){return this.donePromises[t]||(this.donePromises[t]=this._exec(t,e,r,i))}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Store=void 0;const i=r(0),n=r(10);e.Store=class{constructor(t,e,r,n=null){this.name=t,this.finalize=e,this.promiseCtr=r,this.parent=n,this._items=new Map,this.insersions=new i.Subject,this.emptyInsersions=new i.Subject}rewind(t){var e;const r=this._items.get(t);null===(e=null==r?void 0:r.entity)||void 0===e||e.rewind()}prepare(t,e){const r=this.get(t);return new i.Observable(i=>{const n=r.observable.subscribe(i),s=this._items.get(t);if(!s)return;return(s.next=(s.next||{then:(t,e)=>{try{return this.promiseCtr.resolve(e())}catch(t){return this.promiseCtr.reject(t)}}}).then(void 0,()=>{const t=s;if(!s.closed&&!s.ready)return e(s.id,{get ready(){return t.ready}},t=>n.add(t))})).then(void 0,()=>{}),n})}nextBulk(t){const e=t.filter(({id:t,data:e})=>this._next(t,e)).map(({id:t})=>t);this.insersions.next(e)}next(t,e){this._next(t,e)&&this.insersions.next([t])}_next(t,e){const r=this._items.get(t);if(r){if(r.entity)return r.entity.update(e),r.ready=!0,!1;{if(this.parent){const i=this.parent.get(t);r.entity=n.toEntity(new n.ChildEntityImpl({data:e,parentPromise:{then:t=>{var e;const n=i.observable.subscribe(e=>t(e));null===(e=r.parentSubscription)||void 0===e||e.unsubscribe(),r.parentSubscription=n}}}))}else r.entity=n.toEntity(new n.EntityImpl(e));const i=r.entity;return r.ready=!0,r.observers.forEach(t=>t.next(i)),!0}}}updateId(t,e){var r,i;if(this._items.get(e))throw new Error('New Id "'+e+'" is taken');const s=this._items.get(t);if(s&&(s.id=e,this._items.delete(t),this._items.set(e,s),null===(r=s.entity)||void 0===r||r.setParent(),null===(i=s.parentSubscription)||void 0===i||i.unsubscribe(),this.parent)){const t=this.parent.get(e);if(s.entity instanceof n.ChildEntityImpl){const e=s.entity;s.parentSubscription=t.observable.subscribe(t=>{e.setParent(t)})}}}update(t,e){var r,i;null===(i=null===(r=this._items.get(t))||void 0===r?void 0:r.entity)||void 0===i||i.update(e)}item(t,e){let r=this._items.get(t);return r?r.observers.push(e):this._items.set(t,r={id:t,observers:[e]}),r}get(t,e){return n.entityFlow(new i.Observable(r=>{const i=this.item(t,r),s=i.observers;if(i.entity)e||r.next(i.entity);else if(this.parent&&!i.parentSubscription){let r=!e;i.parentSubscription=this.parent.get(t).observable.subscribe(t=>{i.entity=n.toEntity(new n.ChildEntityImpl({data:{},parent:t})),this.emptyInsersions.next(i.id),r&&s.forEach(t=>t.next(i.entity))}),r=!0}return()=>{const t=i.id,e=s.indexOf(r);if(-1!==e&&s.splice(e,1),!s.length){const e=i.parentSubscription;this._items.delete(t),i.closed=!0,i.entity&&this.finalize(t,i.entity),e&&e.unsubscribe()}}}))}}}])}));